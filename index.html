<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quick Receivables SIT Test Plan & Scripts</title>
    <script type="module">
        // Firebase SDK imports
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, signInWithCustomToken, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, doc, setDoc, onSnapshot, collection, query, deleteDoc, getDocs } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        // Global Firebase instances and user ID
        let app;
        let db;
        let auth;
        let userId;
        let isAuthReady = false; // Flag to ensure auth is ready before Firestore operations

        // Global object to store test data and daily progress
        let testData = {};
        let dailyProgress = {};

        // Define all expected test IDs with default pending status
        const allTestIds = [
            'SIT-SAP-001', 'SIT-SAP-002', 'SIT-SAP-003', 'SIT-SAP-004', 'SIT-SAP-005',
            'SIT-MC-001', 'SIT-MC-002', 'SIT-MC-003', 'SIT-MC-004', 'SIT-MC-005',
            'SIT-DUN-001', 'SIT-DUN-002', 'SIT-DUN-003', 'SIT-DUN-004', 'SIT-DUN-005',
            'SIT-DL-001', 'SIT-DL-002', 'SIT-DL-003', 'SIT-DL-004'
        ];

        // Declare currentAppId globally so it's accessible everywhere
        let currentAppId; 

        // Utility function to safely get an element by ID, with logging and polling
        // This is now primarily for summary stats, not main tab content
        function safeGetElementById(id, callback = null, interval = 50, maxAttempts = 100) {
            let attempts = 0;
            const checkElement = () => {
                const element = document.getElementById(id);
                if (element) {
                    if (callback) callback(element);
                    return element;
                } else if (attempts >= maxAttempts) {
                    console.error(`Max attempts reached: Element with ID '${id}' not found after ${maxAttempts * interval}ms. This element might not be in the DOM.`);
                    return null;
                }
                attempts++;
                setTimeout(checkElement, interval); // Re-attempt after interval
            };

            // If no callback, return immediately (for initial non-critical calls)
            if (!callback) {
                return document.getElementById(id);
            }
            // Otherwise, start polling
            checkElement();
            return null; // Return null initially, callback will handle when found
        }

        document.addEventListener('DOMContentLoaded', async () => {
            // Initialize testData with all IDs and default status
            allTestIds.forEach(id => {
                testData[id] = { status: 'pending' };
            });
            
            // Initialize Firebase
            try {
                // IMPORTANT:
                // 1. Go to your Firebase project settings -> Project settings -> General -> Your apps -> Firebase SDK snippet -> Config
                // 2. Copy the ENTIRE 'const firebaseConfig = { ... };' object from there.
                // 3. Paste it directly below this comment block.
                //    Ensure it starts with 'const firebaseConfig = {' and ends with '};'
                //    DO NOT change the variable name 'firebaseConfig'.
                //    Example:
                //    const firebaseConfig = {
                //      apiKey: "AIzaSyB...",
                //      authDomain: "your-project-id.firebaseapp.com",
                //      projectId: "your-project-id",
                //      storageBucket: "your-project-id.appspot.com",
                //      messagingSenderId: "...",
                //      appId: "1:..."
                //    };
                // PASTE YOUR ENTIRE FIREBASE CONFIG OBJECT HERE
                const firebaseConfig = {
                    apiKey: "AIzaSyCI2SAWu8CrpgIoaDWiArFBz-myk0pmKPY",
                    authDomain: "quickreceivablessittestplan.firebaseapp.com",
                    projectId: "quickreceivablessittestplan",
                    storageBucket: "quickreceivablessittestplan.firebasestorage.app",
                    messagingSenderId: "712232670731",
                    appId: "1:712232670731:web:65f31d8e89c19a121ad90e"
                }; // Corrected: Ensure this object is properly closed with '};'

                // Assign currentAppId here, after firebaseConfig is defined.
                // It uses __app_id from Canvas if available, otherwise defaults to the projectId from your firebaseConfig.
                currentAppId = typeof __app_id !== 'undefined' ? __app_id : firebaseConfig.projectId; 
                
                // Determine the final Firebase config to use for initialization.
                // Prioritize __firebase_config from Canvas, otherwise use your pasted firebaseConfig.
                const finalFirebaseConfig = typeof __firebase_config !== 'undefined' ? JSON.parse(__firebase_config) : firebaseConfig;

                console.log("Attempting to initialize Firebase with config:", finalFirebaseConfig);
                app = initializeApp(finalFirebaseConfig);
                db = getFirestore(app);
                auth = getAuth(app);
                console.log("Firebase app and services initialized.");

                // Authenticate user: Try with Canvas token first, then anonymously if not in Canvas or token is undefined
                if (typeof __initial_auth_token !== 'undefined' && __initial_auth_token) {
                    console.log("Attempting to sign in with custom token.");
                    await signInWithCustomToken(auth, __initial_auth_token);
                    console.log("Signed in with custom token.");
                } else {
                    console.log("Attempting to sign in anonymously.");
                    await signInAnonymously(auth);
                    console.log("Signed in anonymously.");
                }

                // Listen for auth state changes
                onAuthStateChanged(auth, (user) => {
                    if (user) {
                        userId = user.uid;
                        const userIdDisplay = safeGetElementById('user-id-display');
                        if (userIdDisplay) userIdDisplay.textContent = `User ID: ${userId}`;
                        isAuthReady = true;
                        console.log("Firebase authenticated. User ID:", userId);
                        
                        // Load data from Firestore after authentication is ready
                        loadTestDataFromFirestore();
                        loadDailyProgressFromFirestore();
                        attachInputListeners();
                        attachDailyInputListeners();
                    } else {
                        console.log("No user signed in.");
                        userId = null;
                        const userIdDisplay = safeGetElementById('user-id-display');
                        if (userIdDisplay) userIdDisplay.textContent = 'User ID: N/A (Sign in required)';
                        isAuthReady = false;
                    }
                });

            } catch (error) {
                console.error("Error initializing Firebase or signing in:", error);
                const userIdDisplay = safeGetElementById('user-id-display');
                if (userIdDisplay) userIdDisplay.textContent = `Error initializing Firebase: ${error.message}`;
            }
        });

        // Use window.onload to ensure all DOM elements are fully loaded and rendered
        window.onload = function() {
            console.log("Executing window.onload functions.");
            // Initialize tabs and summary once the entire page is loaded
            initializeTabFunctionality(); 
            updateOverallSummary(); 
        };

        /**
         * Initializes the tab functionality by setting the active tab based on saved state
         * or defaulting to the 'overview' tab.
         */
        window.initializeTabFunctionality = function() {
            const tabs = document.querySelectorAll('.nav-tab');
            const tabContents = document.querySelectorAll('.tab-content');
            
            // Get last active tab from localStorage or default to 'overview'
            const lastActiveTabId = localStorage.getItem('activeTabId') || 'overview';
            
            // Deactivate all tabs and hide all tab contents initially
            tabs.forEach(tab => {
                if (tab) tab.classList.remove('active');
            });
            tabContents.forEach(content => {
                // Use display: none; for inactive tabs
                if (content) {
                    content.style.display = 'none';
                }
            });

            // Attempt to activate the last active tab and show its content
            const activeTabButton = document.querySelector(`.nav-tab[onclick*="${lastActiveTabId}"]`);
            const activeTabContent = document.getElementById(lastActiveTabId); // Direct access, as onload should ensure presence

            if (activeTabButton && activeTabContent) { // Ensure both elements are found
                activeTabButton.classList.add('active');
                activeTabContent.style.display = 'block'; // Show the content
                console.log(`Successfully activated tab: ${lastActiveTabId}`);
            } else {
                console.warn(`Initial tab content or button for ID '${lastActiveTabId}' not found. Falling back to Overview.`);
                // Fallback to overview if stored tab is not found or content is missing
                const overviewButton = document.querySelector('.nav-tab[onclick*="overview"]');
                const overviewContent = document.getElementById('overview'); // Direct access
                if (overviewButton && overviewContent) {
                    overviewButton.classList.add('active');
                    overviewContent.style.display = 'block'; // Show overview content
                    localStorage.setItem('activeTabId', 'overview');
                    console.log("Fallback to Overview tab successful.");
                } else {
                    console.error("Critical Error: Overview tab elements not found. UI may not function correctly.");
                }
            }
        }

        /**
         * Switches the active tab and displays the corresponding content.
         * @param {string} tabId - The ID of the tab content to display.
         * @param {HTMLElement} clickedButton - The button element that was clicked.
         */
        window.switchTab = function(tabId, clickedButton) {
            // Hide all tab contents using display: none;
            document.querySelectorAll('.tab-content').forEach(content => {
                if (content) {
                    content.style.display = 'none';
                }
            });

            // Deactivate all tab buttons
            document.querySelectorAll('.nav-tab').forEach(button => {
                if (button) button.classList.remove('active');
            });

            const targetTabContent = document.getElementById(tabId); // Direct access
            
            if (targetTabContent) { 
                targetTabContent.style.display = 'block'; // Show the content
                // If the target tab is 'results-summary', ensure summary is updated now that elements are visible
                if (tabId === 'results-summary') {
                    updateOverallSummary(); 
                }
            } else {
                console.error(`Error: Tab content with ID '${tabId}' not found. Falling back to Overview.`);
                // Fallback to a default tab if the requested one doesn't exist
                const overviewButton = document.querySelector('.nav-tab[onclick*="overview"]');
                const overviewContent = document.getElementById('overview'); // Direct access
                if (overviewButton && overviewContent) {
                    overviewButton.classList.add('active');
                    overviewContent.style.display = 'block';
                    localStorage.setItem('activeTabId', 'overview');
                    console.log("Fallback to Overview tab successful.");
                } else {
                    console.error("Critical Error: Overview tab elements not found during fallback. UI may not function correctly.");
                }
                return; // Exit the function if the tab is not found
            }
            
            if (clickedButton) { 
                clickedButton.classList.add('active');
            } else {
                console.warn(`Clicked button element is null for tabId '${tabId}'. Cannot set active class.`);
            }

            // Save the active tab ID to localStorage
            localStorage.setItem('activeTabId', tabId);
        }

        /**
         * Updates the status of a specific test case and saves progress to Firestore.
         * @param {string} testId - The ID of the test case (e.g., 'SIT-SAP-001').
         * @param {string} status - The new status ('pending', 'passed', 'failed', 'blocked', 'na').
         */
        window.updateTestStatus = async function(testId, status) {
            if (!isAuthReady) {
                console.warn("Firestore not ready. Cannot update test status.");
                return;
            }
            if (!testData[testId]) {
                testData[testId] = {};
            }
            testData[testId].status = status;
            await saveTestDataToFirestore(testId, testData[testId]);
            updateOverallSummary();
        }

        /**
         * Attaches event listeners to all input and select elements within test result sections
         * to automatically save their values to Firestore.
         */
        window.attachInputListeners = function() {
            document.querySelectorAll('.test-results-section [data-testid]').forEach(input => {
                input.addEventListener('change', async (event) => {
                    if (!isAuthReady) {
                        console.warn("Firestore not ready. Cannot save input data.");
                        return;
                    }
                    const testId = input.dataset.testid;
                    const field = input.dataset.field;
                    if (testData[testId]) { // Ensure testData[testId] exists before setting property
                        testData[testId][field] = event.target.value;
                    } else {
                        testData[testId] = { [field]: event.target.value };
                    }
                    await saveTestDataToFirestore(testId, testData[testId]);
                });
            });
        }

        /**
         * Attaches event listeners to daily progress input fields.
         */
        window.attachDailyInputListeners = function() {
            document.querySelectorAll('.daily-executed, .daily-passed, .daily-failed, .daily-notes').forEach(input => {
                input.addEventListener('change', async (event) => {
                    if (!isAuthReady) {
                        console.warn("Firestore not ready. Cannot save daily progress.");
                        return;
                    }
                    const date = input.dataset.date;
                    const className = input.className; // e.g., 'daily-executed'
                    
                    if (!dailyProgress[date]) {
                        dailyProgress[date] = {};
                    }
                    dailyProgress[date][className] = event.target.value;
                    await saveDailyProgressToFirestore(date, dailyProgress[date]);
                    updateOverallSummary(); // Update summary when daily inputs change
                });
            });
        }

        /**
         * Updates the values of daily progress input fields from the `dailyProgress` object.
         * This is called on page load after loading from Firestore.
         */
        window.updateDailyProgressInputs = function() {
            document.querySelectorAll('.daily-executed, .daily-passed, .daily-failed, .daily-notes').forEach(input => {
                const date = input.dataset.date;
                const className = input.className;
                if (dailyProgress[date] && dailyProgress[date][className] !== undefined) {
                    input.value = dailyProgress[date][className];
                }
            });
        }

        /**
         * Saves a single test case's data to Firestore.
         * @param {string} testId - The ID of the test case.
         * @param {object} data - The data object for the test case.
         */
        async function saveTestDataToFirestore(testId, data) {
            if (!isAuthReady || !userId) {
                console.warn("Firestore not ready or user not authenticated. Cannot save test data.");
                return;
            }
            try {
                // Use the globally defined currentAppId
                const docRef = doc(db, `artifacts/${currentAppId}/users/${userId}/testResults`, testId);
                await setDoc(docRef, data, { merge: true });
                console.log(`Test data for ${testId} saved to Firestore.`);
            } catch (e) {
                console.error("Error saving test data to Firestore:", e);
            }
        }

        /**
         * Saves daily progress data to Firestore.
         * @param {string} date - The date for the daily progress.
         * @param {object} data - The data object for the daily progress.
         */
        async function saveDailyProgressToFirestore(date, data) {
            if (!isAuthReady || !userId) {
                console.warn("Firestore not ready or user not authenticated. Cannot save daily progress.");
                return;
            }
            try {
                // Use the globally defined currentAppId
                const docRef = doc(db, `artifacts/${currentAppId}/users/${userId}/dailyProgress`, date);
                await setDoc(docRef, data, { merge: true });
                console.log(`Daily progress for ${date} saved to Firestore.`);
            } catch (e) {
                console.error("Error saving daily progress to Firestore:", e);
            }
        }

        /**
         * Loads all test data from Firestore and sets up a real-time listener.
         */
        function loadTestDataFromFirestore() {
            if (!isAuthReady || !userId) {
                console.warn("Firestore not ready or user not authenticated. Cannot load test data.");
                return;
            }
            // Use the globally defined currentAppId
            const testResultsColRef = collection(db, `artifacts/${currentAppId}/users/${userId}/testResults`);
            onSnapshot(testResultsColRef, (snapshot) => {
                // Start with a fresh copy of allTestIds with default pending status
                const newTestData = {};
                allTestIds.forEach(id => {
                    newTestData[id] = { status: 'pending' };
                });

                // Overlay loaded data from Firestore
                snapshot.forEach(doc => {
                    newTestData[doc.id] = { ...newTestData[doc.id], ...doc.data() }; // Merge existing defaults with loaded data
                });
                testData = newTestData; // Update the global testData object
                
                console.log("Test data loaded/updated from Firestore:", testData);
                // Populate UI with loaded data
                document.querySelectorAll('.test-results-section [data-testid]').forEach(input => {
                    const testId = input.dataset.testid;
                    const field = input.dataset.field;
                    if (testData[testId] && testData[testId][field] !== undefined) {
                        input.value = testData[testId][field];
                    }
                });
                document.querySelectorAll('.status-dropdown').forEach(select => {
                    // This part needs to be more robust. Instead of parsing onchange,
                    // use a data attribute or direct ID mapping.
                    // For now, let's assume the testId is directly retrievable.
                    const testId = select.closest('.test-results-section')?.querySelector('[data-testid]')?.dataset.testid;
                    if (testId && testData[testId] && testData[testId].status) {
                        select.value = testData[testId].status;
                    }
                });
                // updateOverallSummary() is now called by window.onload.
            }, (error) => {
                console.error("Error listening to test data:", error);
            });
        }

        /**
         * Loads daily progress data from Firestore.
         */
        function loadDailyProgressFromFirestore() {
            if (!isAuthReady) {
                console.warn("Firestore not ready or user not authenticated. Cannot load daily progress.");
                return;
            }
            // Use the globally defined currentAppId
            const dailyProgressColRef = collection(db, `artifacts/${currentAppId}/users/${userId}/dailyProgress`);
            onSnapshot(dailyProgressColRef, (snapshot) => {
                dailyProgress = {}; // Clear existing data
                snapshot.forEach(doc => {
                    dailyProgress[doc.id] = doc.data();
                });
                console.log("Daily progress loaded/updated from Firestore:", dailyProgress);
                updateDailyProgressInputs();
                // updateOverallSummary() is now called by window.onload.
            }, (error) => {
                console.error("Error listening to daily progress:", error);
            });
        }

        /**
         * Saves the current progress (manual trigger for user).
         */
        window.saveProgress = async function() {
            // Data is already being saved on input change via Firestore listeners.
            // This button can serve as a confirmation or a forced sync if needed,
            // but the auto-save to Firestore on change makes it less critical.
            console.log("Save Progress button clicked. Data is auto-saved to Firestore on input change.");
            showMessageBox("Progress is automatically saved as you make changes.");
        }

        /**
         * Clears all saved data from Firestore and resets the UI.
         */
        window.clearAllData = async function() {
            if (!isAuthReady || !userId) {
                showMessageBox("Cannot clear data: Firestore not ready or user not authenticated.");
                return;
            }

            // Confirm with the user
            const confirmClear = await new Promise(resolve => {
                const modal = document.createElement('div');
                modal.style.cssText = `
                    position: fixed; top: 0; left: 0; width: 100%; height: 100%;
                    background: rgba(0,0,0,0.6); display: flex; justify-content: center; align-items: center;
                    z-index: 9999;
                `;
                const content = document.createElement('div');
                content.style.cssText = `
                    background: white; padding: 25px; border-radius: 8px; box-shadow: 0 5px 15px rgba(0,0,0,0.3);
                    text-align: center; max-width: 400px; width: 90%;
                `;
                const p = document.createElement('p');
                p.textContent = "Are you sure you want to clear ALL saved test data and daily progress? This action cannot be undone.";
                p.style.marginBottom = '20px';
                const buttonContainer = document.createElement('div');
                buttonContainer.style.display = 'flex';
                buttonContainer.style.justifyContent = 'center';
                buttonContainer.style.gap = '10px';

                const confirmBtn = document.createElement('button');
                confirmBtn.textContent = 'Yes, Clear All';
                confirmBtn.style.cssText = `
                    padding: 10px 20px; background: #dc3545; color: white; border: none; border-radius: 5px;
                    cursor: pointer; font-size: 14px;
                `;
                confirmBtn.onclick = () => { document.body.removeChild(modal); resolve(true); };

                const cancelBtn = document.createElement('button');
                cancelBtn.textContent = 'Cancel';
                cancelBtn.style.cssText = `
                    padding: 10px 20px; background: #6c757d; color: white; border: none; border-radius: 5px;
                    cursor: pointer; font-size: 14px;
                `;
                cancelBtn.onclick = () => { document.body.removeChild(modal); resolve(false); };

                // Corrected order: paragraph first, then buttons
                content.appendChild(p); 
                content.appendChild(buttonContainer); 
                modal.appendChild(content);
                document.body.appendChild(modal);
            });

            if (!confirmClear) {
                return; // User cancelled
            }

            try {
                // Delete all test data documents
                const testResultsQuery = collection(db, `artifacts/${currentAppId}/users/${userId}/testResults`);
                const testResultsSnapshot = await getDocs(testResultsQuery);
                const deleteTestPromises = [];
                testResultsSnapshot.forEach(doc => {
                    deleteTestPromises.push(deleteDoc(doc.ref));
                });
                await Promise.all(deleteTestPromises);

                // Delete all daily progress documents
                const dailyProgressQuery = collection(db, `artifacts/${currentAppId}/users/${userId}/dailyProgress`);
                const dailyProgressSnapshot = await getDocs(dailyProgressQuery);
                const deleteDailyPromises = [];
                dailyProgressSnapshot.forEach(doc => {
                    deleteDailyPromises.push(deleteDoc(doc.ref));
                });
                await Promise.all(deleteDailyPromises);

                // Reset local data and UI
                allTestIds.forEach(id => {
                    testData[id] = { status: 'pending' }; // Reset to default pending
                });
                dailyProgress = {};
                
                // Clear all input fields in the UI
                document.querySelectorAll('.test-results-section [data-testid]').forEach(input => {
                    if (input.tagName === 'SELECT') {
                        input.value = 'pending'; // Reset dropdowns
                    } else {
                        input.value = ''; // Clear text/number inputs
                    }
                });
                document.querySelectorAll('.daily-executed, .daily-passed, .daily-failed').forEach(input => input.value = '0');
                document.querySelectorAll('.daily-notes').forEach(input => input.value = '');

                updateOverallSummary();
                showMessageBox("All data cleared successfully!");
            } catch (e) {
                console.error("Error clearing data from Firestore:", e);
                showMessageBox("Error clearing data. Please check console for details.");
            }
        }

        /**
         * Updates the overall summary statistics and category progress.
         */
        window.updateOverallSummary = function() {
            let totalPassed = 0;
            let totalFailed = 0;
            let totalBlocked = 0;
            let totalPending = 0;
            let totalTestsCounted = 0; // Only count tests that are not N/A for coverage

            // Define which test IDs belong to the 'Error Handling' category
            const ehTestIds = ['SIT-SAP-005', 'SIT-DUN-005', 'SIT-DL-003'];

            const categoryStats = {
                'SAP': { total: 5, passed: 0, failed: 0, blocked: 0, pending: 0 },
                'MC': { total: 5, passed: 0, failed: 0, blocked: 0, pending: 0 },
                'DUN': { total: 5, passed: 0, failed: 0, blocked: 0, pending: 0 },
                'DL': { total: 4, passed: 0, failed: 0, blocked: 0, pending: 0 },
                'EH': { total: ehTestIds.length, passed: 0, failed: 0, blocked: 0, pending: 0 } // Total for EH is based on defined EH tests
            };

            // Iterate through the allTestIds to ensure all are considered
            allTestIds.forEach(testId => {
                const status = testData[testId] && testData[testId].status ? testData[testId].status : 'pending'; // Default to pending

                // Update counts for primary categories (SAP, MC, DUN, DL)
                const categoryPrefix = testId.substring(4, testId.indexOf('-', 4));
                const categoryKey = Object.keys(categoryStats).find(key => testId.includes(key) && key !== 'EH');

                if (categoryKey) {
                    switch (status) {
                        case 'passed':
                            categoryStats[categoryKey].passed++;
                            break;
                        case 'failed':
                            categoryStats[categoryKey].failed++;
                            break;
                        case 'blocked':
                            categoryStats[categoryKey].blocked++;
                            break;
                        case 'pending':
                            categoryStats[categoryKey].pending++;
                            break;
                    }
                }

                // Update counts for Error Handling category specifically
                if (ehTestIds.includes(testId)) {
                    switch (status) {
                        case 'passed':
                            categoryStats['EH'].passed++;
                            break;
                        case 'failed':
                            categoryStats['EH'].failed++;
                            break;
                        case 'blocked':
                            categoryStats['EH'].blocked++;
                            break;
                        case 'pending':
                            categoryStats['EH'].pending++;
                            break;
                    }
                }

                // Update overall totals (each test counted once for overall summary)
                if (status !== 'na') { // Only count non-N/A tests for overall totals
                    totalTestsCounted++;
                    switch (status) {
                        case 'passed':
                            totalPassed++;
                            break;
                        case 'failed':
                            totalFailed++;
                            break;
                        case 'blocked':
                            totalBlocked++;
                            break;
                        case 'pending':
                            totalPending++;
                            break;
                    }
                }
            });

            // Update overall summary stats - Using safeGetElementById
            const statPassed = safeGetElementById('stat-passed');
            if (statPassed) statPassed.textContent = totalPassed;
            
            const statFailed = safeGetElementById('stat-failed');
            if (statFailed) statFailed.textContent = totalFailed;

            const statBlocked = safeGetElementById('stat-blocked');
            if (statBlocked) statBlocked.textContent = totalBlocked;

            const statPending = safeGetElementById('stat-pending');
            if (statPending) statPending.textContent = totalPending;

            const statTotal = safeGetElementById('stat-total');
            if (statTotal) statTotal.textContent = totalTestsCounted; 
            
            const coverage = totalTestsCounted > 0 ? ((totalPassed / totalTestsCounted) * 100).toFixed(1) : 0;
            const statCoverage = safeGetElementById('stat-coverage');
            if (statCoverage) statCoverage.textContent = `${coverage}%`;


            // Update category-specific stats - Using safeGetElementById
            for (const key in categoryStats) {
                if (categoryStats.hasOwnProperty(key)) {
                    const stats = categoryStats[key];
                    const passedElement = safeGetElementById(`${key.toLowerCase()}-passed`);
                    if (passedElement) passedElement.textContent = stats.passed;
                    
                    const failedElement = safeGetElementById(`${key.toLowerCase()}-failed`);
                    if (failedElement) failedElement.textContent = stats.failed;
                    
                    const blockedElement = safeGetElementById(`${key.toLowerCase()}-blocked`);
                    if (blockedElement) blockedElement.textContent = stats.blocked;
                    
                    const pendingElement = safeGetElementById(`${key.toLowerCase()}-pending`);
                    if (pendingElement) pendingElement.textContent = stats.pending;
                    
                    const categoryTotal = stats.total;
                    const categoryExecuted = stats.passed + stats.failed + stats.blocked;
                    const categoryProgress = categoryTotal > 0 ? ((categoryExecuted / categoryTotal) * 100).toFixed(1) : 0;
                    const progressElement = safeGetElementById(`${key.toLowerCase()}-progress`);
                    if (progressElement) progressElement.textContent = `${categoryProgress}%`;
                }
            }
        }

        let selectedExportFormat = '';

        /**
         * Shows the export format selection modal.
         */
        window.showExportModal = function() {
            const exportModal = safeGetElementById('exportFormatModal');
            if (exportModal) exportModal.style.display = 'flex';
        }

        /**
         * Closes the export format selection modal.
         */
        window.closeExportModal = function() {
            const exportModal = safeGetElementById('exportFormatModal');
            if (exportModal) exportModal.style.display = 'none';
            // Deselect any chosen format
            document.querySelectorAll('.format-option').forEach(option => {
                if (option) option.classList.remove('selected');
            });
            selectedExportFormat = '';
        }

        // Add event listeners for format options
        document.querySelectorAll('.format-option').forEach(option => {
            option.addEventListener('click', () => {
                document.querySelectorAll('.format-option').forEach(opt => {
                    if (opt) opt.classList.remove('selected');
                });
                if (option) option.classList.add('selected');
                selectedExportFormat = option.dataset.format;
            });
        });

        /**
         * Handles the export process based on the selected format.
         */
        window.exportResults = function() {
            if (!selectedExportFormat) {
                // Using a custom message box instead of alert()
                showMessageBox('Please select an export format.');
                return;
            }

            switch (selectedExportFormat) {
                case 'csv':
                    exportToCsv();
                    break;
                default:
                    console.error('Unknown export format:', selectedExportFormat);
            }
            closeExportModal();
        }

        /**
         * Custom message box function (replaces alert()).
         * @param {string} message - The message to display.
         */
        function showMessageBox(message) {
            const modal = document.createElement('div');
            modal.style.cssText = `
                position: fixed; top: 0; left: 0; width: 100%; height: 100%;
                background: rgba(0,0,0,0.6); display: flex; justify-content: center; align-items: center;
                z-index: 9999;
            `;
            const content = document.createElement('div');
            content.style.cssText = `
                background: white; padding: 25px; border-radius: 8px; box-shadow: 0 5px 15px rgba(0,0,0,0.3);
                text-align: center; max-width: 400px; width: 90%;
            `;
            const p = document.createElement('p');
            p.textContent = message;
            p.style.marginBottom = '20px';
            const button = document.createElement('button');
            button.textContent = 'OK';
            button.style.cssText = `
                padding: 10px 20px; background: #007bff; color: white; border: none; border-radius: 5px;
                cursor: pointer; font-size: 16px;
            `;
            button.onclick = () => {
                if (document.body.contains(modal)) { // Check if modal is still in DOM before removing
                    document.body.removeChild(modal);
                }
            };
            content.appendChild(p);
            content.appendChild(button);
            modal.appendChild(content);
            document.body.appendChild(modal);
        }

        /**
         * Exports the test data to a CSV file.
         */
        function exportToCsv() {
            let csvContent = "Test ID,Status,Executed By,Execution Date,Execution Time (minutes),Environment,Build Version,Test Notes / Comments,Defect ID,Retest Required,Priority\n";

            // Collect data from testData object
            for (const testId in testData) {
                if (testData.hasOwnProperty(testId)) {
                    const data = testData[testId];
                    // Ensure all fields are present, even if empty, to maintain column integrity
                    const row = [
                        testId,
                        data.status || '',
                        data.tester || '',
                        data.date || '',
                        data.duration || '',
                        data.environment || '',
                        data.build || '',
                        `"${(data.notes || '').replace(/"/g, '""')}"`, // Escape quotes for CSV
                        data.defect || '',
                        data.retest || '',
                        data.priority || ''
                    ].join(',');
                    csvContent += row + '\n';
                }
            }

            const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            if (link.download !== undefined) { // feature detection
                const url = URL.createObjectURL(blob);
                link.setAttribute('href', url);
                link.setAttribute('download', 'QuickReceivables_SIT_Test_Results.csv');
                link.style.visibility = 'hidden';
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
            }
        }
    </script>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 12px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            overflow: hidden;
        }
        
        .header {
            background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%);
            color: white;
            padding: 30px;
            text-align: center;
            position: relative;
            padding-top: 60px; /* Increased padding to make space for buttons */
        }
        
        .header h1 {
            margin: 0;
            font-size: 2.5em;
            font-weight: 300;
        }
        
        .header p {
            margin: 10px 0 0 0;
            opacity: 0.9;
            font-size: 1.1em;
        }
        
        .export-controls {
            position: absolute;
            top: 20px;
            right: 20px;
            display: flex;
            gap: 10px;
        }
        
        .export-btn {
            background: rgba(255,255,255,0.2);
            color: white;
            border: 1px solid rgba(255,255,255,0.3);
            padding: 8px 16px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 12px;
            transition: all 0.3s ease;
        }
        
        .export-btn:hover {
            background: rgba(255,255,255,0.3);
            transform: translateY(-2px);
        }

        .user-info {
            position: absolute;
            top: 20px;
            left: 20px;
            color: rgba(255,255,255,0.7);
            font-size: 0.8em;
        }
        
        .nav-tabs {
            display: flex;
            background: #f8f9fa;
            border-bottom: 2px solid #e9ecef;
            overflow-x: auto;
        }
        
        .nav-tab {
            padding: 15px 20px;
            background: transparent;
            border: none;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            color: #495057;
            white-space: nowrap;
            transition: all 0.3s ease;
        }
        
        .nav-tab:hover {
            background: #e9ecef;
            color: #007bff;
        }
        
        .nav-tab.active {
            background: #007bff;
            color: white;
        }
        
        .tab-content {
            /* Changed from display: none; to ensure elements are in the DOM */
            display: none; /* Reverted to display: none; */
            padding: 30px;
            line-height: 1.6;
            box-sizing: border-box; /* Include padding in width calculation */
        }
        
        .tab-content.active {
            display: block; /* Show the content */
        }
        
        .section-header {
            font-size: 1.8em;
            color: #2c3e50;
            margin: 30px 0 20px 0;
            border-bottom: 3px solid #3498db;
            padding-bottom: 10px;
        }
        
        .test-overview {
            background: linear-gradient(135deg, #74b9ff 0%, #0984e3 100%);
            color: white;
            padding: 25px;
            border-radius: 8px;
            margin: 20px 0;
        }
        
        .test-overview h3 {
            margin-top: 0;
            font-size: 1.4em;
        }
        
        .test-category {
            background: #f8f9fa;
            border-left: 4px solid #28a745;
            padding: 20px;
            margin: 20px 0;
            border-radius: 0 8px 8px 0;
        }
        
        .test-category h4 {
            color: #28a745;
            margin-top: 0;
        }
        
        .table-container {
            overflow-x: auto;
            margin: 20px 0;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            background: white;
        }
        
        th {
            background: linear-gradient(135deg, #3498db 0%, #2980b9 100%);
            color: white;
            padding: 15px 12px;
            text-align: left;
            font-weight: 600;
            font-size: 12px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        td {
            padding: 12px 8px;
            border-bottom: 1px solid #e9ecef;
            font-size: 13px;
            vertical-align: top;
        }
        
        tr:hover {
            background: #f8f9fa;
        }
        
        .priority-critical { background: #ffe6e6; color: #d63031; font-weight: bold; }
        .priority-high { background: #fff3cd; color: #e17055; font-weight: bold; }
        .priority-medium { background: #e8f5e8; color: #00b894; font-weight: bold; }
        
        .status-pending { background: #e3f2fd; color: #1976d2; padding: 4px 8px; border-radius: 4px; }
        .status-passed { background: #e8f5e8; color: #388e3c; padding: 4px 8px; border-radius: 4px; }
        .status-failed { background: #ffebee; color: #d32f2f; padding: 4px 8px; border-radius: 4px; }
        .status-blocked { background: #fff3e0; color: #f57c00; padding: 4px 8px; border-radius: 4px; }
        .status-na { background: #f5f5f5; color: #757575; padding: 4px 8px; border-radius: 4px; }
        
        .test-step {
            background: white;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            padding: 20px;
            margin: 15px 0;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .test-step h5 {
            color: #2c3e50;
            margin-top: 0;
            border-bottom: 1px solid #eee;
            padding-bottom: 10px;
        }
        
        .test-results-section {
            background: #f8f9fa;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
        }
        
        .test-results-section h4 {
            color: #2c3e50;
            margin-top: 0;
            margin-bottom: 15px;
        }
        
        .result-grid {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 15px;
            margin: 15px 0;
        }
        
        .result-field {
            display: flex;
            flex-direction: column;
        }
        
        .result-field label {
            font-weight: 600;
            margin-bottom: 5px;
            color: #495057;
            font-size: 12px;
        }
        
        .result-field input, .result-field select, .result-field textarea {
            padding: 8px 12px;
            border: 1px solid #ced4da;
            border-radius: 4px;
            font-size: 14px;
            box-sizing: border-box;
        }
        
        .result-field textarea {
            min-height: 60px;
            resize: vertical;
        }
        
        .status-dropdown {
            background: white;
            cursor: pointer;
        }
        
        .status-dropdown:focus {
            outline: none;
            border-color: #007bff;
            box-shadow: 0 0 0 2px rgba(0,123,255,0.25);
        }
        
        .daily-executed, .daily-passed, .daily-failed {
            width: 60px !important;
            padding: 6px 8px;
            border: 1px solid #ced4da;
            border-radius: 4px;
            text-align: center;
            font-size: 14px;
        }
        
        .daily-notes {
            width: 100% !important;
            max-width: 200px;
            padding: 6px 8px;
            border: 1px solid #ced4da;
            border-radius: 4px;
            font-size: 14px;
        }
        
        .pre-conditions {
            background: #e8f5e8;
            border-radius: 6px;
            padding: 15px;
            margin: 15px 0;
        }
        
        .test-data {
            background: #fff3cd;
            border-radius: 6px;
            padding: 15px;
            margin: 15px 0;
        }
        
        .expected-result {
            background: #e3f2fd;
            border-radius: 6px;
            padding: 15px;
            margin: 15px 0;
        }
        
        .timeline-item {
            background: white;
            border-left: 4px solid #3498db;
            padding: 15px 20px;
            margin: 10px 0;
            border-radius: 0 8px 8px 0;
        }
        
        .timeline-item h4 {
            margin: 0 0 10px 0;
            color: #2c3e50;
        }
        
        .integration-flow {
            background: #f8f9fa;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
            text-align: center;
        }
        
        .flow-step {
            display: inline-block;
            background: #007bff;
            color: white;
            padding: 10px 15px;
            margin: 5px;
            border-radius: 5px;
            font-size: 12px;
        }
        
        .flow-arrow {
            color: #666;
            font-size: 18px;
            margin: 0 10px;
        }
        
        .summary-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }
        
        .stat-card {
            background: white;
            border: 1px solid #e9ecef;
            border-radius: 8px;
            padding: 20px;
            text-align: center;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .stat-number {
            font-size: 2em;
            font-weight: bold;
            margin-bottom: 5px;
        }
        
    .stat-number.passed { color: #28a745; }
    .stat-number.failed { color: #dc3545; }
    .stat-number.pending { color: #007bff; }
    .stat-number.blocked { color: #ffc107; }
        
        .stat-label {
            font-size: 12px;
            color: #6c757d;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .export-format-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }
        
        .modal-content {
            background: white;
            padding: 30px;
            border-radius: 8px;
            max-width: 500px;
            width: 90%;
        }
        
        .modal-content h3 {
            margin-top: 0;
            color: #2c3e50;
        }
        
        .format-options {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }
        
        .format-option {
            background: #f8f9fa;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            padding: 20px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .format-option:hover {
            border-color: #007bff;
            background: #e3f2fd;
        }
        
        .format-option.selected {
            border-color: #007bff;
            background: #e3f2fd;
            color: #007bff;
        }
        
        .modal-buttons {
            display: flex;
            gap: 10px;
            justify-content: flex-end;
            margin-top: 20px;
        }
        
        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s ease;
        }
        
        .btn-primary {
            background: #007bff;
            color: white;
        }
        
        .btn-primary:hover {
            background: #0056b3;
        }
        
        .btn-secondary {
            background: #6c757d;
            color: white;
        }
        
        .btn-secondary:hover {
            background: #545b62;
        }
        
        @media print {
            .export-controls, .nav-tabs, .user-info { display: none; }
            .container { box-shadow: none; border-radius: 0; }
            body { background: white; padding: 0; }
            .header { padding: 20px; } /* Adjust header padding for print */
        }
        
        @media (max-width: 768px) {
            .result-grid {
                grid-template-columns: 1fr;
            }
            
            .export-controls {
                position: static;
                margin-bottom: 15px;
                justify-content: center;
            }
            
            .header {
                text-align: center; /* Center header on small screens if buttons are static */
                padding-top: 30px; /* Reset padding for smaller screens */
            }
            .user-info {
                position: static;
                text-align: center;
                margin-bottom: 10px;
            }
            
            .daily-notes {
                max-width: 150px;
            }
            
            .daily-executed, .daily-passed, .daily-failed {
                width: 50px !important;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="user-info" id="user-id-display">User ID: N/A</div>
            <div class="export-controls">
                <button class="export-btn" onclick="showExportModal()">📊 Export Results</button>
                <button class="export-btn" onclick="window.print()">🖨️ Print</button>
                <button class="export-btn" onclick="saveProgress()">💾 Save Progress</button>
                <button class="export-btn" onclick="clearAllData()">🗑️ Clear Data</button>
            </div>
            <h1>Quick Receivables SIT Test Plan</h1>
            <p>System Integration Testing | WillScot | Aug 11-22, 2025</p>
        </div>
        
        <div class="nav-tabs">
            <button class="nav-tab active" onclick="switchTab('overview', this)">Test Overview</button>
            <button class="nav-tab" onclick="switchTab('results-summary', this)">📊 Results Summary</button>
            <button class="nav-tab" onclick="switchTab('sap-integration', this)">SAP Integration</button>
            <button class="nav-tab" onclick="switchTab('marketing-cloud', this)">Marketing Cloud</button>
            <button class="nav-tab" onclick="switchTab('dunning-automation', this)">Dunning Automation</button>
            <button class="nav-tab" onclick="switchTab('data-loader', this)">Data Loader Scripts</button>
            <button class="nav-tab" onclick="switchTab('schedule', this)">Test Schedule</button>
        </div>
        
        <!-- Test Overview Tab -->
        <div id="overview" class="tab-content active">
            <h2 class="section-header">SIT Test Plan Overview</h2>
            
            <div class="test-overview">
                <h3>🎯 SIT Testing Objectives</h3>
                <ul>
                    <li><strong>SAP to Salesforce Integration</strong> - Validate complete data flow from SAP to Quick Receivables</li>
                    <li><strong>Marketing Cloud Integration</strong> - Verify dunning email automation and tracking</li>
                    <li><strong>Data Processing Automation</strong> - Test Node.js file watcher and Data Loader CLI automation</li>
                    <li><strong>End-to-End Workflows</strong> - Validate complete AR automation processes</li>
                    <li><strong>Error Handling & Recovery</strong> - Test failure scenarios and recovery mechanisms</li>
                </ul>
            </div>
            
            <div class="timeline-item">
                <h4>📅 SIT Timeline: August 11-22, 2025</h4>
                <p><strong>Duration:</strong> 10 business days</p>
                <p><strong>Environment:</strong> WillScot Salesforce Sandbox with Quick Receivables managed package</p>
                <p><strong>Data:</strong> SAP test data extracts (ARCUST, ARMAST, ARCASH, AREXTI)</p>
            </div>
            
            <h3>Test Environment Architecture</h3>
            <div class="integration-flow">
                <span class="flow-step">SAP Test System</span>
                <span class="flow-arrow">→</span>
                <span class="flow-step">Wilscot Server</span>
                <span class="flow-arrow">→</span>
                <span class="flow-step">Node.js Watcher</span>
                <span class="flow-arrow">→</span>
                <span class="flow-step">Data Loader CLI</span>
                <span class="flow-arrow">→</span>
                <span class="flow-step">Salesforce Sandbox</span>
                <span class="flow-arrow">→</span>
                <span class="flow-step">Marketing Cloud</span>
            </div>
            
            <h3>Test Categories & Coverage</h3>
            <div class="table-container">
                <table>
                    <thead>
                        <tr>
                            <th>Test Category</th>
                            <th>Test Count</th>
                            <th>Priority</th>
                            <th>Dependencies</th>
                            <th>Estimated Effort</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><strong>SAP Data Integration</strong></td>
                            <td>5 test cases</td>
                            <td><span class="priority-critical">Critical</span></td>
                            <td>SAP test data, Server access</td>
                            <td>3 days</td>
                        </tr>
                        <tr>
                            <td><strong>Marketing Cloud Integration</strong></td>
                            <td>5 test cases</td>
                            <td><span class="priority-high">High</span></td>
                            <td>MC Connect, Email templates</td>
                            <td>2 days</td>
                        </tr>
                        <tr>
                            <td><strong>Dunning Automation</strong></td>
                            <td>5 test cases</td>
                            <td><span class="priority-high">High</span></td>
                            <td>CMDT configuration, Task creation</td>
                            <td>2 days</td>
                        </tr>
                        <tr>
                            <td><strong>Data Loader Automation</strong></td>
                            <td>4 test cases</td>
                            <td><span class="priority-high">High</span></td>
                            <td>Node.js script, CLI setup</td>
                            <td>1.5 days</td>
                        </tr>
                        <tr>
                            <td><strong>Error Handling & Recovery</strong></td>
                            <td>3 test cases</td>
                            <td><span class="priority-medium">Medium</span></td>
                            <td>All integrations working</td>
                            <td>1.5 days</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
        
        <!-- Results Summary Tab -->
        <div id="results-summary" class="tab-content">
            <h2 class="section-header">Test Execution Results Summary</h2>
            
            <div class="summary-stats">
                <div class="stat-card">
                    <div class="stat-number passed" id="stat-passed">0</div>
                    <div class="stat-label">Passed</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number failed" id="stat-failed">0</div>
                    <div class="stat-label">Failed</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number blocked" id="stat-blocked">0</div>
                    <div class="stat-label">Blocked</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number pending" id="stat-pending">19</div>
                    <div class="stat-label">Pending</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="stat-total">19</div>
                    <div class="stat-label">Total Tests</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="stat-coverage">0%</div>
                    <div class="stat-label">Coverage</div>
                </div>
            </div>
            
            <h3>Test Execution Progress by Category</h3>
            <div class="table-container">
                <table>
                    <thead>
                        <tr>
                            <th>Date</th>
                            <th>Planned Test Cases</th>
                            <th>Executed</th>
                            <th>Passed</th>
                            <th>Failed</th>
                            <th>Daily Notes</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><strong>Aug 11, 2025</strong></td>
                            <td>SIT-SAP-001, SIT-SAP-002</td>
                            <td><input type="number" min="0" max="2" value="0" class="daily-executed" data-date="aug11"></td>
                            <td><input type="number" min="0" max="2" value="0" class="daily-passed" data-date="aug11"></td>
                            <td><input type="number" min="0" max="2" value="0" class="daily-failed" data-date="aug11"></td>
                            <td><input type="text" placeholder="Daily notes..." class="daily-notes" data-date="aug11"></td>
                        </tr>
                        <tr>
                            <td><strong>Aug 12, 2025</strong></td>
                            <td>SIT-SAP-003, SIT-DL-001</td>
                            <td><input type="number" min="0" max="2" value="0" class="daily-executed" data-date="aug12"></td>
                            <td><input type="number" min="0" max="2" value="0" class="daily-passed" data-date="aug12"></td>
                            <td><input type="number" min="0" max="2" value="0" class="daily-failed" data-date="aug12"></td>
                            <td><input type="text" placeholder="Daily notes..." class="daily-notes" data-date="aug12"></td>
                        </tr>
                        <tr>
                            <td><strong>Aug 13, 2025</strong></td>
                            <td>SIT-DL-002, SIT-DL-003</td>
                            <td><input type="number" min="0" max="2" value="0" class="daily-executed" data-date="aug13"></td>
                            <td><input type="number" min="0" max="2" value="0" class="daily-passed" data-date="aug13"></td>
                            <td><input type="number" min="0" max="2" value="0" class="daily-failed" data-date="aug13"></td>
                            <td><input type="text" placeholder="Daily notes..." class="daily-notes" data-date="aug13"></td>
                        </tr>
                        <tr>
                            <td><strong>Aug 14, 2025</strong></td>
                            <td>SIT-DL-004, SIT-SAP-004</td>
                            <td><input type="number" min="0" max="2" value="0" class="daily-executed" data-date="aug14"></td>
                            <td><input type="number" min="0" max="2" value="0" class="daily-passed" data-date="aug14"></td>
                            <td><input type="number" min="0" max="2" value="0"  class="daily-failed" data-date="aug14"></td>
                            <td><input type="text" placeholder="Daily notes..." class="daily-notes" data-date="aug14"></td>
                        </tr>
                        <tr>
                            <td><strong>Aug 15, 2025</strong></td>
                            <td>SIT-MC-001, SIT-MC-002</td>
                            <td><input type="number" min="0" max="2" value="0" class="daily-executed" data-date="aug15"></td>
                            <td><input type="number" min="0" max="2" value="0" class="daily-passed" data-date="aug15"></td>
                            <td><input type="number" min="0" max="2" value="0" class="daily-failed" data-date="aug15"></td>
                            <td><input type="text" placeholder="Daily notes..." class="daily-notes" data-date="aug15"></td>
                        </tr>
                        <tr>
                            <td><strong>Aug 18, 2025</strong></td>
                            <td>SIT-MC-003, SIT-MC-004</td>
                            <td><input type="number" min="0" max="2" value="0" class="daily-executed" data-date="aug18"></td>
                            <td><input type="number" min="0" max="2" value="0" class="daily-passed" data-date="aug18"></td>
                            <td><input type="number" min="0" max="2" value="0" class="daily-failed" data-date="aug18"></td>
                            <td><input type="text" placeholder="Daily notes..." class="daily-notes" data-date="aug18"></td>
                        </tr>
                        <tr>
                            <td><strong>Aug 19, 2025</strong></td>
                            <td>SIT-MC-005, SIT-DUN-001</td>
                            <td><input type="number" min="0" max="2" value="0" class="daily-executed" data-date="aug19"></td>
                            <td><input type="number" min="0" max="2" value="0" class="daily-passed" data-date="aug19"></td>
                            <td><input type="number" min="0" max="2" value="0" class="daily-failed" data-date="aug19"></td>
                            <td><input type="text" placeholder="Daily notes..." class="daily-notes" data-date="aug19"></td>
                        </tr>
                        <tr>
                            <td><strong>Aug 20, 2025</strong></td>
                            <td>SIT-DUN-002, SIT-DUN-003</td>
                            <td><input type="number" min="0" max="2" value="0" class="daily-executed" data-date="aug20"></td>
                            <td><input type="number" min="0" max="2" value="0" class="daily-passed" data-date="aug20"></td>
                            <td><input type="number" min="0" max="2" value="0" class="daily-failed" data-date="aug20"></td>
                            <td><input type="text" placeholder="Daily notes..." class="daily-notes" data-date="aug20"></td>
                        </tr>
                        <tr>
                            <td><strong>Aug 21, 2025</strong></td>
                            <td>SIT-DUN-004, SIT-DUN-005</td>
                            <td><input type="number" min="0" max="2" value="0" class="daily-executed" data-date="aug21"></td>
                            <td><input type="number" min="0" max="2" value="0" class="daily-passed" data-date="aug21"></td>
                            <td><input type="number" min="0" max="2" value="0" class="daily-failed" data-date="aug21"></td>
                            <td><input type="text" placeholder="Daily notes..." class="daily-notes" data-date="aug21"></td>
                        </tr>
                        <tr>
                            <td><strong>Aug 22, 2025</strong></td>
                            <td>SIT-SAP-005</td>
                            <td><input type="number" min="0" max="1" value="0" class="daily-executed" data-date="aug22"></td>
                            <td><input type="number" min="0" max="1" value="0" class="daily-passed" data-date="aug22"></td>
                            <td><input type="number" min="0" max="1" value="0" class="daily-failed" data-date="aug22"></td>
                            <td><input type="text" placeholder="Daily notes..." class="daily-notes" data-date="aug22"></td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- Export Format Modal -->
    <div id="exportFormatModal" class="export-format-modal">
        <div class="modal-content">
            <h3>Select Export Format</h3>
            <div class="format-options">
                <div class="format-option" data-format="csv">
                    <h4>CSV</h4>
                    <p>Comma Separated Values</p>
                </div>
                <!-- Add more format options here if needed -->
            </div>
            <div class="modal-buttons">
                <button class="btn btn-secondary" onclick="closeExportModal()">Cancel</button>
                <button class="btn btn-primary" onclick="exportResults()">Export</button>
            </div>
        </div>
    </div>
</body>
</html>
