<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quick Receivables SIT Test Plan & Scripts</title>
    <script type="module">
        // Firebase SDK imports
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, signInWithCustomToken, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, doc, setDoc, onSnapshot, collection, query, deleteDoc, getDocs } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        // Global Firebase instances and user ID
        let app;
        let db;
        let auth;
        let userId;
        let isAuthReady = false; // Flag to ensure auth is ready before Firestore operations

        // Global object to store test data and daily progress
        let testData = {};
        let dailyProgress = {};

        // Define all expected test IDs with default pending status
        const allTestIds = [
            'SIT-SAP-001', 'SIT-SAP-002', 'SIT-SAP-003', 'SIT-SAP-004', 'SIT-SAP-005',
            'SIT-MC-001', 'SIT-MC-002', 'SIT-MC-003', 'SIT-MC-004', 'SIT-MC-005',
            'SIT-DUN-001', 'SIT-DUN-002', 'SIT-DUN-003', 'SIT-DUN-004', 'SIT-DUN-005',
            'SIT-DL-001', 'SIT-DL-002', 'SIT-DL-003', 'SIT-DL-004'
        ];

        // Declare currentAppId globally so it's accessible everywhere
        let currentAppId; 

        document.addEventListener('DOMContentLoaded', async () => {
            // Initialize testData with all IDs and default status
            allTestIds.forEach(id => {
                testData[id] = { status: 'pending' };
            });
            
            // Initialize Firebase
            try {
                // IMPORTANT:
                // 1. Go to your Firebase project settings -> Project settings -> General -> Your apps -> Firebase SDK snippet -> Config
                // 2. Copy the ENTIRE 'const firebaseConfig = { ... };' object from there.
                // 3. Paste it directly below this comment block.
                //    Ensure it starts with 'const firebaseConfig = {' and ends with '};'
                //    DO NOT change the variable name 'firebaseConfig'.
                //    Example:
                //    const firebaseConfig = {
                //      apiKey: "AIzaSyB...",
                //      authDomain: "your-project-id.firebaseapp.com",
                //      projectId: "your-project-id",
                //      storageBucket: "your-project-id.appspot.com",
                //      messagingSenderId: "...",
                //      appId: "1:..."
                //    };
                // PASTE YOUR ENTIRE FIREBASE CONFIG OBJECT HERE
                const firebaseConfig = {
                    apiKey: "AIzaSyCI2SAWu8CrpgIoaDWiArFBz-myk0pmKPY",
                    authDomain: "quickreceivablessittestplan.firebaseapp.com",
                    projectId: "quickreceivablessittestplan",
                    storageBucket: "quickreceivablessittestplan.firebasestorage.app",
                    messagingSenderId: "712232670731",
                    appId: "1:712232670731:web:65f31d8e89c19a121ad90e"
                }; // Corrected: Ensure this object is properly closed with '};'

                // Assign currentAppId here, after firebaseConfig is defined.
                // It uses __app_id from Canvas if available, otherwise defaults to the projectId from your firebaseConfig.
                currentAppId = typeof __app_id !== 'undefined' ? __app_id : firebaseConfig.projectId; 
                
                // Determine the final Firebase config to use for initialization.
                // Prioritize __firebase_config from Canvas, otherwise use your pasted firebaseConfig.
                const finalFirebaseConfig = typeof __firebase_config !== 'undefined' ? JSON.parse(__firebase_config) : firebaseConfig;

                console.log("Attempting to initialize Firebase with config:", finalFirebaseConfig);
                app = initializeApp(finalFirebaseConfig);
                db = getFirestore(app);
                auth = getAuth(app);
                console.log("Firebase app and services initialized.");

                // Authenticate user: Try with Canvas token first, then anonymously if not in Canvas or token is undefined
                if (typeof __initial_auth_token !== 'undefined' && __initial_auth_token) {
                    console.log("Attempting to sign in with custom token.");
                    await signInWithCustomToken(auth, __initial_auth_token);
                    console.log("Signed in with custom token.");
                } else {
                    console.log("Attempting to sign in anonymously.");
                    await signInAnonymously(auth);
                    console.log("Signed in anonymously.");
                }

                // Listen for auth state changes
                onAuthStateChanged(auth, (user) => {
                    if (user) {
                        userId = user.uid;
                        document.getElementById('user-id-display').textContent = `User ID: ${userId}`;
                        isAuthReady = true;
                        console.log("Firebase authenticated. User ID:", userId);
                        
                        // Load data from Firestore after authentication is ready
                        loadTestDataFromFirestore();
                        loadDailyProgressFromFirestore();
                        initializeTabFunctionality();
                        attachInputListeners(); // Attach listeners after loading data
                        attachDailyInputListeners(); // Attach listeners for daily inputs
                    } else {
                        console.log("No user signed in.");
                        userId = null;
                        document.getElementById('user-id-display').textContent = 'User ID: N/A (Sign in required)';
                        isAuthReady = false;
                        // If not authenticated, ensure UI reflects default pending state
                        updateOverallSummary(); 
                    }
                });

            } catch (error) {
                console.error("Error initializing Firebase or signing in:", error);
                document.getElementById('user-id-display').textContent = `Error initializing Firebase: ${error.message}`; // Display error message
                updateOverallSummary(); // Update summary even if Firebase init fails
            }
        });

        /**
         * Initializes the tab functionality by setting the active tab based on saved state
         * or defaulting to the 'overview' tab.
         */
        window.initializeTabFunctionality = function() {
            const tabs = document.querySelectorAll('.nav-tab');
            const tabContents = document.querySelectorAll('.tab-content');
            
            // Get last active tab from localStorage or default to 'overview'
            const lastActiveTabId = localStorage.getItem('activeTabId') || 'overview';
            
            // Deactivate all tabs and hide all tab contents initially
            tabs.forEach(tab => tab.classList.remove('active'));
            tabContents.forEach(content => content.classList.remove('active'));

            // Activate the last active tab and show its content
            const activeTabButton = document.querySelector(`.nav-tab[onclick*="${lastActiveTabId}"]`);
            const activeTabContent = document.getElementById(lastActiveTabId);

            if (activeTabButton && activeTabContent) {
                activeTabButton.classList.add('active');
                activeTabContent.classList.add('active');
            } else {
                // Fallback to overview if stored tab is not found or content is missing
                document.querySelector('.nav-tab').classList.add('active');
                document.getElementById('overview').classList.add('active');
                localStorage.setItem('activeTabId', 'overview');
            }
        }

        /**
         * Switches the active tab and displays the corresponding content.
         * @param {string} tabId - The ID of the tab content to display.
         * @param {HTMLElement} clickedButton - The button element that was clicked.
         */
        window.switchTab = function(tabId, clickedButton) {
            // Hide all tab contents
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });

            // Deactivate all tab buttons
            document.querySelectorAll('.nav-tab').forEach(button => {
                button.classList.remove('active');
            });

            // Show the selected tab content
            document.getElementById(tabId).classList.add('active');

            // Activate the clicked tab button
            clickedButton.classList.add('active');

            // Save the active tab ID to localStorage
            localStorage.setItem('activeTabId', tabId);
        }

        /**
         * Updates the status of a specific test case and saves progress to Firestore.
         * @param {string} testId - The ID of the test case (e.g., 'SIT-SAP-001').
         * @param {string} status - The new status ('pending', 'passed', 'failed', 'blocked', 'na').
         */
        window.updateTestStatus = async function(testId, status) {
            if (!isAuthReady) {
                console.warn("Firestore not ready. Cannot update test status.");
                return;
            }
            if (!testData[testId]) {
                testData[testId] = {};
            }
            testData[testId].status = status;
            await saveTestDataToFirestore(testId, testData[testId]);
            updateOverallSummary();
        }

        /**
         * Attaches event listeners to all input and select elements within test result sections
         * to automatically save their values to Firestore.
         */
        window.attachInputListeners = function() {
            document.querySelectorAll('.test-results-section [data-testid]').forEach(input => {
                input.addEventListener('change', async (event) => {
                    if (!isAuthReady) {
                        console.warn("Firestore not ready. Cannot save input data.");
                        return;
                    }
                    const testId = input.dataset.testid;
                    const field = input.dataset.field;
                    if (!testData[testId]) {
                        testData[testId] = {};
                    }
                    testData[testId][field] = event.target.value;
                    await saveTestDataToFirestore(testId, testData[testId]);
                });
            });
        }

        /**
         * Attaches event listeners to daily progress input fields.
         */
        window.attachDailyInputListeners = function() {
            document.querySelectorAll('.daily-executed, .daily-passed, .daily-failed, .daily-notes').forEach(input => {
                input.addEventListener('change', async (event) => {
                    if (!isAuthReady) {
                        console.warn("Firestore not ready. Cannot save daily progress.");
                        return;
                    }
                    const date = input.dataset.date;
                    const className = input.className; // e.g., 'daily-executed'
                    
                    if (!dailyProgress[date]) {
                        dailyProgress[date] = {};
                    }
                    dailyProgress[date][className] = event.target.value;
                    await saveDailyProgressToFirestore(date, dailyProgress[date]);
                    updateOverallSummary(); // Update summary when daily inputs change
                });
            });
        }

        /**
         * Updates the values of daily progress input fields from the `dailyProgress` object.
         * This is called on page load after loading from Firestore.
         */
        window.updateDailyProgressInputs = function() {
            document.querySelectorAll('.daily-executed, .daily-passed, .daily-failed, .daily-notes').forEach(input => {
                const date = input.dataset.date;
                const className = input.className;
                if (dailyProgress[date] && dailyProgress[date][className] !== undefined) {
                    input.value = dailyProgress[date][className];
                }
            });
        }

        /**
         * Saves a single test case's data to Firestore.
         * @param {string} testId - The ID of the test case.
         * @param {object} data - The data object for the test case.
         */
        async function saveTestDataToFirestore(testId, data) {
            if (!isAuthReady || !userId) {
                console.warn("Firestore not ready or user not authenticated. Cannot save test data.");
                return;
            }
            try {
                // Use the globally defined currentAppId
                const docRef = doc(db, `artifacts/${currentAppId}/users/${userId}/testResults`, testId);
                await setDoc(docRef, data, { merge: true });
                console.log(`Test data for ${testId} saved to Firestore.`);
            } catch (e) {
                console.error("Error saving test data to Firestore:", e);
            }
        }

        /**
         * Saves daily progress data to Firestore.
         * @param {string} date - The date for the daily progress.
         * @param {object} data - The data object for the daily progress.
         */
        async function saveDailyProgressToFirestore(date, data) {
            if (!isAuthReady || !userId) {
                console.warn("Firestore not ready or user not authenticated. Cannot save daily progress.");
                return;
            }
            try {
                // Use the globally defined currentAppId
                const docRef = doc(db, `artifacts/${currentAppId}/users/${userId}/dailyProgress`, date);
                await setDoc(docRef, data, { merge: true });
                console.log(`Daily progress for ${date} saved to Firestore.`);
            } catch (e) {
                console.error("Error saving daily progress to Firestore:", e);
            }
        }

        /**
         * Loads all test data from Firestore and sets up a real-time listener.
         */
        function loadTestDataFromFirestore() {
            if (!isAuthReady || !userId) {
                console.warn("Firestore not ready or user not authenticated. Cannot load test data.");
                return;
            }
            // Use the globally defined currentAppId
            const testResultsColRef = collection(db, `artifacts/${currentAppId}/users/${userId}/testResults`);
            onSnapshot(testResultsColRef, (snapshot) => {
                // Start with a fresh copy of allTestIds with default pending status
                const newTestData = {};
                allTestIds.forEach(id => {
                    newTestData[id] = { status: 'pending' };
                });

                // Overlay loaded data from Firestore
                snapshot.forEach(doc => {
                    newTestData[doc.id] = { ...newTestData[doc.id], ...doc.data() }; // Merge existing defaults with loaded data
                });
                testData = newTestData; // Update the global testData object
                
                console.log("Test data loaded/updated from Firestore:", testData);
                // Populate UI with loaded data
                document.querySelectorAll('.test-results-section [data-testid]').forEach(input => {
                    const testId = input.dataset.testid;
                    const field = input.dataset.field;
                    if (testData[testId] && testData[testId][field] !== undefined) {
                        input.value = testData[testId][field];
                    }
                });
                document.querySelectorAll('.status-dropdown').forEach(select => {
                    // This part needs to be more robust. Instead of parsing onchange,
                    // use a data attribute or direct ID mapping.
                    // For now, let's assume the testId is directly retrievable.
                    const testId = select.closest('.test-results-section')?.querySelector('[data-testid]')?.dataset.testid;
                    if (testId && testData[testId] && testData[testId].status) {
                        select.value = testData[testId].status;
                    }
                });
                updateOverallSummary();
            }, (error) => {
                console.error("Error listening to test data:", error);
            });
        }

        /**
         * Loads daily progress data from Firestore and sets up a real-time listener.
         */
        function loadDailyProgressFromFirestore() {
            if (!isAuthReady || !userId) {
                console.warn("Firestore not ready or user not authenticated. Cannot load daily progress.");
                return;
            }
            // Use the globally defined currentAppId
            const dailyProgressColRef = collection(db, `artifacts/${currentAppId}/users/${userId}/dailyProgress`);
            onSnapshot(dailyProgressColRef, (snapshot) => {
                dailyProgress = {}; // Clear existing data
                snapshot.forEach(doc => {
                    dailyProgress[doc.id] = doc.data();
                });
                console.log("Daily progress loaded/updated from Firestore:", dailyProgress);
                updateDailyProgressInputs();
                updateOverallSummary();
            }, (error) => {
                console.error("Error listening to daily progress:", error);
            });
        }

        /**
         * Saves the current progress (manual trigger for user).
         */
        window.saveProgress = async function() {
            // Data is already being saved on input change via Firestore listeners.
            // This button can serve as a confirmation or a forced sync if needed,
            // but the auto-save to Firestore on change makes it less critical.
            console.log("Save Progress button clicked. Data is auto-saved to Firestore on input change.");
            showMessageBox("Progress is automatically saved as you make changes.");
        }

        /**
         * Clears all saved data from Firestore and resets the UI.
         */
        window.clearAllData = async function() {
            if (!isAuthReady || !userId) {
                showMessageBox("Cannot clear data: Firestore not ready or user not authenticated.");
                return;
            }

            // Confirm with the user
            const confirmClear = await new Promise(resolve => {
                const modal = document.createElement('div');
                modal.style.cssText = `
                    position: fixed; top: 0; left: 0; width: 100%; height: 100%;
                    background: rgba(0,0,0,0.6); display: flex; justify-content: center; align-items: center;
                    z-index: 9999;
                `;
                const content = document.createElement('div');
                content.style.cssText = `
                    background: white; padding: 25px; border-radius: 8px; box-shadow: 0 5px 15px rgba(0,0,0,0.3);
                    text-align: center; max-width: 400px; width: 90%;
                `;
                const p = document.createElement('p');
                p.textContent = "Are you sure you want to clear ALL saved test data and daily progress? This action cannot be undone.";
                p.style.marginBottom = '20px';
                const buttonContainer = document.createElement('div');
                buttonContainer.style.display = 'flex';
                buttonContainer.style.justifyContent = 'center';
                buttonContainer.style.gap = '10px';

                const confirmBtn = document.createElement('button');
                confirmBtn.textContent = 'Yes, Clear All';
                confirmBtn.style.cssText = `
                    padding: 10px 20px; background: #dc3545; color: white; border: none; border-radius: 5px;
                    cursor: pointer; font-size: 14px;
                `;
                confirmBtn.onclick = () => { document.body.removeChild(modal); resolve(true); };

                const cancelBtn = document.createElement('button');
                cancelBtn.textContent = 'Cancel';
                cancelBtn.style.cssText = `
                    padding: 10px 20px; background: #6c757d; color: white; border: none; border-radius: 5px;
                    cursor: pointer; font-size: 14px;
                `;
                cancelBtn.onclick = () => { document.body.removeChild(modal); resolve(false); };

                // Corrected order: paragraph first, then buttons
                content.appendChild(p); 
                content.appendChild(buttonContainer); 
                modal.appendChild(content);
                document.body.appendChild(modal);
            });

            if (!confirmClear) {
                return; // User cancelled
            }

            try {
                // Delete all test data documents
                const testResultsQuery = collection(db, `artifacts/${currentAppId}/users/${userId}/testResults`);
                const testResultsSnapshot = await getDocs(testResultsQuery);
                const deleteTestPromises = [];
                testResultsSnapshot.forEach(doc => {
                    deleteTestPromises.push(deleteDoc(doc.ref));
                });
                await Promise.all(deleteTestPromises);

                // Delete all daily progress documents
                const dailyProgressQuery = collection(db, `artifacts/${currentAppId}/users/${userId}/dailyProgress`);
                const dailyProgressSnapshot = await getDocs(dailyProgressQuery);
                const deleteDailyPromises = [];
                dailyProgressSnapshot.forEach(doc => {
                    deleteDailyPromises.push(deleteDoc(doc.ref));
                });
                await Promise.all(deleteDailyPromises);

                // Reset local data and UI
                allTestIds.forEach(id => {
                    testData[id] = { status: 'pending' }; // Reset to default pending
                });
                dailyProgress = {};
                
                // Clear all input fields in the UI
                document.querySelectorAll('.test-results-section [data-testid]').forEach(input => {
                    if (input.tagName === 'SELECT') {
                        input.value = 'pending'; // Reset dropdowns
                    } else {
                        input.value = ''; // Clear text/number inputs
                    }
                });
                document.querySelectorAll('.daily-executed, .daily-passed, .daily-failed').forEach(input => input.value = '0');
                document.querySelectorAll('.daily-notes').forEach(input => input.value = '');

                updateOverallSummary();
                showMessageBox("All data cleared successfully!");
            } catch (e) {
                console.error("Error clearing data from Firestore:", e);
                showMessageBox("Error clearing data. Please check console for details.");
            }
        }

        /**
         * Updates the overall summary statistics and category progress.
         */
        window.updateOverallSummary = function() {
            let totalPassed = 0;
            let totalFailed = 0;
            let totalBlocked = 0;
            let totalPending = 0;
            let totalTestsCounted = 0; // Only count tests that are not N/A for coverage

            // Define which test IDs belong to the 'Error Handling' category
            const ehTestIds = ['SIT-SAP-005', 'SIT-DUN-005', 'SIT-DL-003'];

            const categoryStats = {
                'SAP': { total: 5, passed: 0, failed: 0, blocked: 0, pending: 0 },
                'MC': { total: 5, passed: 0, failed: 0, blocked: 0, pending: 0 },
                'DUN': { total: 5, passed: 0, failed: 0, blocked: 0, pending: 0 },
                'DL': { total: 4, passed: 0, failed: 0, blocked: 0, pending: 0 },
                'EH': { total: ehTestIds.length, passed: 0, failed: 0, blocked: 0, pending: 0 } // Total for EH is based on defined EH tests
            };

            // Iterate through the allTestIds to ensure all are considered
            allTestIds.forEach(testId => {
                const status = testData[testId] && testData[testId].status ? testData[testId].status : 'pending'; // Default to pending

                // Update counts for primary categories (SAP, MC, DUN, DL)
                const categoryPrefix = testId.substring(4, testId.indexOf('-', 4));
                const categoryKey = Object.keys(categoryStats).find(key => testId.includes(key) && key !== 'EH');

                if (categoryKey) {
                    switch (status) {
                        case 'passed':
                            categoryStats[categoryKey].passed++;
                            break;
                        case 'failed':
                            categoryStats[categoryKey].failed++;
                            break;
                        case 'blocked':
                            categoryStats[categoryKey].blocked++;
                            break;
                        case 'pending':
                            categoryStats[categoryKey].pending++;
                            break;
                    }
                }

                // Update counts for Error Handling category specifically
                if (ehTestIds.includes(testId)) {
                    switch (status) {
                        case 'passed':
                            categoryStats['EH'].passed++;
                            break;
                        case 'failed':
                            categoryStats['EH'].failed++;
                            break;
                        case 'blocked':
                            categoryStats['EH'].blocked++;
                            break;
                        case 'pending':
                            categoryStats['EH'].pending++;
                            break;
                    }
                }

                // Update overall totals (each test counted once for overall summary)
                if (status !== 'na') { // Only count non-N/A tests for overall totals
                    totalTestsCounted++;
                    switch (status) {
                        case 'passed':
                            totalPassed++;
                            break;
                        case 'failed':
                            totalFailed++;
                            break;
                        case 'blocked':
                            totalBlocked++;
                            break;
                        case 'pending':
                            totalPending++;
                            break;
                    }
                }
            });

            // Update overall summary stats
            document.getElementById('stat-passed').textContent = totalPassed;
            document.getElementById('stat-failed').textContent = totalFailed;
            document.getElementById('stat-blocked').textContent = totalBlocked;
            document.getElementById('stat-pending').textContent = totalPending;
            document.getElementById('stat-total').textContent = totalTestsCounted; // Total tests that are not N/A
            
            const coverage = totalTestsCounted > 0 ? ((totalPassed / totalTestsCounted) * 100).toFixed(1) : 0;
            document.getElementById('stat-coverage').textContent = `${coverage}%`;

            // Update category-specific stats
            for (const key in categoryStats) {
                if (categoryStats.hasOwnProperty(key)) {
                    const stats = categoryStats[key];
                    document.getElementById(`${key.toLowerCase()}-passed`).textContent = stats.passed;
                    document.getElementById(`${key.toLowerCase()}-failed`).textContent = stats.failed;
                    document.getElementById(`${key.toLowerCase()}-blocked`).textContent = stats.blocked;
                    document.getElementById(`${key.toLowerCase()}-pending`).textContent = stats.pending;
                    
                    const categoryTotal = stats.total;
                    const categoryExecuted = stats.passed + stats.failed + stats.blocked;
                    const categoryProgress = categoryTotal > 0 ? ((categoryExecuted / categoryTotal) * 100).toFixed(1) : 0;
                    document.getElementById(`${key.toLowerCase()}-progress`).textContent = `${categoryProgress}%`;
                }
            }
        }

        let selectedExportFormat = '';

        /**
         * Shows the export format selection modal.
         */
        window.showExportModal = function() {
            document.getElementById('exportFormatModal').style.display = 'flex';
        }

        /**
         * Closes the export format selection modal.
         */
        window.closeExportModal = function() {
            document.getElementById('exportFormatModal').style.display = 'none';
            // Deselect any chosen format
            document.querySelectorAll('.format-option').forEach(option => {
                option.classList.remove('selected');
            });
            selectedExportFormat = '';
        }

        // Add event listeners for format options
        document.querySelectorAll('.format-option').forEach(option => {
            option.addEventListener('click', () => {
                document.querySelectorAll('.format-option').forEach(opt => opt.classList.remove('selected'));
                option.classList.add('selected');
                selectedExportFormat = option.dataset.format;
            });
        });

        /**
         * Handles the export process based on the selected format.
         */
        window.exportResults = function() {
            if (!selectedExportFormat) {
                // Using a custom message box instead of alert()
                showMessageBox('Please select an export format.');
                return;
            }

            switch (selectedExportFormat) {
                case 'csv':
                    exportToCsv();
                    break;
                default:
                    console.error('Unknown export format:', selectedExportFormat);
            }
            closeExportModal();
        }

        /**
         * Custom message box function (replaces alert()).
         * @param {string} message - The message to display.
         */
        function showMessageBox(message) {
            const modal = document.createElement('div');
            modal.style.cssText = `
                position: fixed; top: 0; left: 0; width: 100%; height: 100%;
                background: rgba(0,0,0,0.6); display: flex; justify-content: center; align-items: center;
                z-index: 9999;
            `;
            const content = document.createElement('div');
            content.style.cssText = `
                background: white; padding: 25px; border-radius: 8px; box-shadow: 0 5px 15px rgba(0,0,0,0.3);
                text-align: center; max-width: 400px; width: 90%;
            `;
            const p = document.createElement('p');
            p.textContent = message;
            p.style.marginBottom = '20px';
            const button = document.createElement('button');
            button.textContent = 'OK';
            button.style.cssText = `
                padding: 10px 20px; background: #007bff; color: white; border: none; border-radius: 5px;
                cursor: pointer; font-size: 16px;
            `;
            button.onclick = () => document.body.removeChild(modal);
            content.appendChild(p);
            content.appendChild(button);
            modal.appendChild(content);
            document.body.appendChild(modal);
        }

        /**
         * Exports the test data to a CSV file.
         */
        function exportToCsv() {
            let csvContent = "Test ID,Status,Executed By,Execution Date,Execution Time (minutes),Environment,Build Version,Test Notes / Comments,Defect ID,Retest Required,Priority\n";

            // Collect data from testData object
            for (const testId in testData) {
                if (testData.hasOwnProperty(testId)) {
                    const data = testData[testId];
                    // Ensure all fields are present, even if empty, to maintain column integrity
                    const row = [
                        testId,
                        data.status || '',
                        data.tester || '',
                        data.date || '',
                        data.duration || '',
                        data.environment || '',
                        data.build || '',
                        `"${(data.notes || '').replace(/"/g, '""')}"`, // Escape quotes for CSV
                        data.defect || '',
                        data.retest || '',
                        data.priority || ''
                    ].join(',');
                    csvContent += row + '\n';
                }
            }

            const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            if (link.download !== undefined) { // feature detection
                const url = URL.createObjectURL(blob);
                link.setAttribute('href', url);
                link.setAttribute('download', 'QuickReceivables_SIT_Test_Results.csv');
                link.style.visibility = 'hidden';
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
            }
        }
    </script>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 12px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            overflow: hidden;
        }
        
        .header {
            background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%);
            color: white;
            padding: 30px;
            text-align: center;
            position: relative;
            padding-top: 60px; /* Increased padding to make space for buttons */
        }
        
        .header h1 {
            margin: 0;
            font-size: 2.5em;
            font-weight: 300;
        }
        
        .header p {
            margin: 10px 0 0 0;
            opacity: 0.9;
            font-size: 1.1em;
        }
        
        .export-controls {
            position: absolute;
            top: 20px;
            right: 20px;
            display: flex;
            gap: 10px;
        }
        
        .export-btn {
            background: rgba(255,255,255,0.2);
            color: white;
            border: 1px solid rgba(255,255,255,0.3);
            padding: 8px 16px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 12px;
            transition: all 0.3s ease;
        }
        
        .export-btn:hover {
            background: rgba(255,255,255,0.3);
            transform: translateY(-2px);
        }

        .user-info {
            position: absolute;
            top: 20px;
            left: 20px;
            color: rgba(255,255,255,0.7);
            font-size: 0.8em;
        }
        
        .nav-tabs {
            display: flex;
            background: #f8f9fa;
            border-bottom: 2px solid #e9ecef;
            overflow-x: auto;
        }
        
        .nav-tab {
            padding: 15px 20px;
            background: transparent;
            border: none;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            color: #495057;
            white-space: nowrap;
            transition: all 0.3s ease;
        }
        
        .nav-tab:hover {
            background: #e9ecef;
            color: #007bff;
        }
        
        .nav-tab.active {
            background: #007bff;
            color: white;
        }
        
        .tab-content {
            display: none;
            padding: 30px;
            line-height: 1.6;
        }
        
        .tab-content.active {
            display: block;
        }
        
        .section-header {
            font-size: 1.8em;
            color: #2c3e50;
            margin: 30px 0 20px 0;
            border-bottom: 3px solid #3498db;
            padding-bottom: 10px;
        }
        
        .test-overview {
            background: linear-gradient(135deg, #74b9ff 0%, #0984e3 100%);
            color: white;
            padding: 25px;
            border-radius: 8px;
            margin: 20px 0;
        }
        
        .test-overview h3 {
            margin-top: 0;
            font-size: 1.4em;
        }
        
        .test-category {
            background: #f8f9fa;
            border-left: 4px solid #28a745;
            padding: 20px;
            margin: 20px 0;
            border-radius: 0 8px 8px 0;
        }
        
        .test-category h4 {
            color: #28a745;
            margin-top: 0;
        }
        
        .table-container {
            overflow-x: auto;
            margin: 20px 0;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            background: white;
        }
        
        th {
            background: linear-gradient(135deg, #3498db 0%, #2980b9 100%);
            color: white;
            padding: 15px 12px;
            text-align: left;
            font-weight: 600;
            font-size: 12px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        td {
            padding: 12px 8px;
            border-bottom: 1px solid #e9ecef;
            font-size: 13px;
            vertical-align: top;
        }
        
        tr:hover {
            background: #f8f9fa;
        }
        
        .priority-critical { background: #ffe6e6; color: #d63031; font-weight: bold; }
        .priority-high { background: #fff3cd; color: #e17055; font-weight: bold; }
        .priority-medium { background: #e8f5e8; color: #00b894; font-weight: bold; }
        
        .status-pending { background: #e3f2fd; color: #1976d2; padding: 4px 8px; border-radius: 4px; }
        .status-passed { background: #e8f5e8; color: #388e3c; padding: 4px 8px; border-radius: 4px; }
        .status-failed { background: #ffebee; color: #d32f2f; padding: 4px 8px; border-radius: 4px; }
        .status-blocked { background: #fff3e0; color: #f57c00; padding: 4px 8px; border-radius: 4px; }
        .status-na { background: #f5f5f5; color: #757575; padding: 4px 8px; border-radius: 4px; }
        
        .test-step {
            background: white;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            padding: 20px;
            margin: 15px 0;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .test-step h5 {
            color: #2c3e50;
            margin-top: 0;
            border-bottom: 1px solid #eee;
            padding-bottom: 10px;
        }
        
        .test-results-section {
            background: #f8f9fa;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
        }
        
        .test-results-section h4 {
            color: #2c3e50;
            margin-top: 0;
            margin-bottom: 15px;
        }
        
        .result-grid {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 15px;
            margin: 15px 0;
        }
        
        .result-field {
            display: flex;
            flex-direction: column;
        }
        
        .result-field label {
            font-weight: 600;
            margin-bottom: 5px;
            color: #495057;
            font-size: 12px;
        }
        
        .result-field input, .result-field select, .result-field textarea {
            padding: 8px 12px;
            border: 1px solid #ced4da;
            border-radius: 4px;
            font-size: 14px;
            box-sizing: border-box;
        }
        
        .result-field textarea {
            min-height: 60px;
            resize: vertical;
        }
        
        .status-dropdown {
            background: white;
            cursor: pointer;
        }
        
        .status-dropdown:focus {
            outline: none;
            border-color: #007bff;
            box-shadow: 0 0 0 2px rgba(0,123,255,0.25);
        }
        
        .daily-executed, .daily-passed, .daily-failed {
            width: 60px !important;
            padding: 6px 8px;
            border: 1px solid #ced4da;
            border-radius: 4px;
            text-align: center;
            font-size: 14px;
        }
        
        .daily-notes {
            width: 100% !important;
            max-width: 200px;
            padding: 6px 8px;
            border: 1px solid #ced4da;
            border-radius: 4px;
            font-size: 14px;
        }
        
        .pre-conditions {
            background: #e8f5e8;
            border-radius: 6px;
            padding: 15px;
            margin: 15px 0;
        }
        
        .test-data {
            background: #fff3cd;
            border-radius: 6px;
            padding: 15px;
            margin: 15px 0;
        }
        
        .expected-result {
            background: #e3f2fd;
            border-radius: 6px;
            padding: 15px;
            margin: 15px 0;
        }
        
        .timeline-item {
            background: white;
            border-left: 4px solid #3498db;
            padding: 15px 20px;
            margin: 10px 0;
            border-radius: 0 8px 8px 0;
        }
        
        .timeline-item h4 {
            margin: 0 0 10px 0;
            color: #2c3e50;
        }
        
        .integration-flow {
            background: #f8f9fa;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
            text-align: center;
        }
        
        .flow-step {
            display: inline-block;
            background: #007bff;
            color: white;
            padding: 10px 15px;
            margin: 5px;
            border-radius: 5px;
            font-size: 12px;
        }
        
        .flow-arrow {
            color: #666;
            font-size: 18px;
            margin: 0 10px;
        }
        
        .summary-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }
        
        .stat-card {
            background: white;
            border: 1px solid #e9ecef;
            border-radius: 8px;
            padding: 20px;
            text-align: center;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .stat-number {
            font-size: 2em;
            font-weight: bold;
            margin-bottom: 5px;
        }
        
        .stat-number.passed { color: #28a745; }
        .stat-number.failed { color: #dc3545; }
        .stat-number.pending { color: #007bff; }
        .stat-number.blocked { color: #ffc107; }
        
        .stat-label {
            font-size: 12px;
            color: #6c757d;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .export-format-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }
        
        .modal-content {
            background: white;
            padding: 30px;
            border-radius: 8px;
            max-width: 500px;
            width: 90%;
        }
        
        .modal-content h3 {
            margin-top: 0;
            color: #2c3e50;
        }
        
        .format-options {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }
        
        .format-option {
            background: #f8f9fa;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            padding: 20px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .format-option:hover {
            border-color: #007bff;
            background: #e3f2fd;
        }
        
        .format-option.selected {
            border-color: #007bff;
            background: #e3f2fd;
            color: #007bff;
        }
        
        .modal-buttons {
            display: flex;
            gap: 10px;
            justify-content: flex-end;
            margin-top: 20px;
        }
        
        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s ease;
        }
        
        .btn-primary {
            background: #007bff;
            color: white;
        }
        
        .btn-primary:hover {
            background: #0056b3;
        }
        
        .btn-secondary {
            background: #6c757d;
            color: white;
        }
        
        .btn-secondary:hover {
            background: #545b62;
        }
        
        @media print {
            .export-controls, .nav-tabs, .user-info { display: none; }
            .container { box-shadow: none; border-radius: 0; }
            body { background: white; padding: 0; }
            .header { padding: 20px; } /* Adjust header padding for print */
        }
        
        @media (max-width: 768px) {
            .result-grid {
                grid-template-columns: 1fr;
            }
            
            .export-controls {
                position: static;
                margin-bottom: 15px;
                justify-content: center;
            }
            
            .header {
                text-align: center; /* Center header on small screens if buttons are static */
                padding-top: 30px; /* Reset padding for smaller screens */
            }
            .user-info {
                position: static;
                text-align: center;
                margin-bottom: 10px;
            }
            
            .daily-notes {
                max-width: 150px;
            }
            
            .daily-executed, .daily-passed, .daily-failed {
                width: 50px !important;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="user-info" id="user-id-display">User ID: N/A</div>
            <div class="export-controls">
                <button class="export-btn" onclick="showExportModal()">üìä Export Results</button>
                <button class="export-btn" onclick="window.print()">üñ®Ô∏è Print</button>
                <button class="export-btn" onclick="saveProgress()">üíæ Save Progress</button>
                <button class="export-btn" onclick="clearAllData()">üóëÔ∏è Clear Data</button>
            </div>
            <h1>Quick Receivables SIT Test Plan</h1>
            <p>System Integration Testing | WillScot | Aug 11-22, 2025</p>
        </div>
        
        <div class="nav-tabs">
            <button class="nav-tab active" onclick="switchTab('overview', this)">Test Overview</button>
            <button class="nav-tab" onclick="switchTab('results-summary', this)">üìä Results Summary</button>
            <button class="nav-tab" onclick="switchTab('sap-integration', this)">SAP Integration</button>
            <button class="nav-tab" onclick="switchTab('marketing-cloud', this)">Marketing Cloud</button>
            <button class="nav-tab" onclick="switchTab('dunning-automation', this)">Dunning Automation</button>
            <button class="nav-tab" onclick="switchTab('data-loader', this)">Data Loader Scripts</button>
            <button class="nav-tab" onclick="switchTab('schedule', this)">Test Schedule</button>
        </div>
        
        <!-- Test Overview Tab -->
        <div id="overview" class="tab-content active">
            <h2 class="section-header">SIT Test Plan Overview</h2>
            
            <div class="test-overview">
                <h3>üéØ SIT Testing Objectives</h3>
                <ul>
                    <li><strong>SAP to Salesforce Integration</strong> - Validate complete data flow from SAP to Quick Receivables</li>
                    <li><strong>Marketing Cloud Integration</strong> - Verify dunning email automation and tracking</li>
                    <li><strong>Data Processing Automation</strong> - Test Node.js file watcher and Data Loader CLI automation</li>
                    <li><strong>End-to-End Workflows</strong> - Validate complete AR automation processes</li>
                    <li><strong>Error Handling & Recovery</strong> - Test failure scenarios and recovery mechanisms</li>
                </ul>
            </div>
            
            <div class="timeline-item">
                <h4>üìÖ SIT Timeline: August 11-22, 2025</h4>
                <p><strong>Duration:</strong> 10 business days</p>
                <p><strong>Environment:</strong> WillScot Salesforce Sandbox with Quick Receivables managed package</p>
                <p><strong>Data:</strong> SAP test data extracts (ARCUST, ARMAST, ARCASH, AREXTI)</p>
            </div>
            
            <h3>Test Environment Architecture</h3>
            <div class="integration-flow">
                <span class="flow-step">SAP Test System</span>
                <span class="flow-arrow">‚Üí</span>
                <span class="flow-step">Wilscot Server</span>
                <span class="flow-arrow">‚Üí</span>
                <span class="flow-step">Node.js Watcher</span>
                <span class="flow-arrow">‚Üí</span>
                <span class="flow-step">Data Loader CLI</span>
                <span class="flow-arrow">‚Üí</span>
                <span class="flow-step">Salesforce Sandbox</span>
                <span class="flow-arrow">‚Üí</span>
                <span class="flow-step">Marketing Cloud</span>
            </div>
            
            <h3>Test Categories & Coverage</h3>
            <div class="table-container">
                <table>
                    <thead>
                        <tr>
                            <th>Test Category</th>
                            <th>Test Count</th>
                            <th>Priority</th>
                            <th>Dependencies</th>
                            <th>Estimated Effort</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><strong>SAP Data Integration</strong></td>
                            <td>5 test cases</td>
                            <td><span class="priority-critical">Critical</span></td>
                            <td>SAP test data, Server access</td>
                            <td>3 days</td>
                        </tr>
                        <tr>
                            <td><strong>Marketing Cloud Integration</strong></td>
                            <td>5 test cases</td>
                            <td><span class="priority-high">High</span></td>
                            <td>MC Connect, Email templates</td>
                            <td>2 days</td>
                        </tr>
                        <tr>
                            <td><strong>Dunning Automation</strong></td>
                            <td>5 test cases</td>
                            <td><span class="priority-high">High</span></td>
                            <td>CMDT configuration, Task creation</td>
                            <td>2 days</td>
                        </tr>
                        <tr>
                            <td><strong>Data Loader Automation</strong></td>
                            <td>4 test cases</td>
                            <td><span class="priority-high">High</span></td>
                            <td>Node.js script, CLI setup</td>
                            <td>1.5 days</td>
                        </tr>
                        <tr>
                            <td><strong>Error Handling & Recovery</strong></td>
                            <td>3 test cases</td>
                            <td><span class="priority-medium">Medium</span></td>
                            <td>All integrations working</td>
                            <td>1.5 days</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
        
        <!-- Results Summary Tab -->
        <div id="results-summary" class="tab-content">
            <h2 class="section-header">Test Execution Results Summary</h2>
            
            <div class="summary-stats">
                <div class="stat-card">
                    <div class="stat-number passed" id="stat-passed">0</div>
                    <div class="stat-label">Passed</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number failed" id="stat-failed">0</div>
                    <div class="stat-label">Failed</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number blocked" id="stat-blocked">0</div>
                    <div class="stat-label">Blocked</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number pending" id="stat-pending">19</div>
                    <div class="stat-label">Pending</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="stat-total">19</div>
                    <div class="stat-label">Total Tests</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="stat-coverage">0%</div>
                    <div class="stat-label">Coverage</div>
                </div>
            </div>
            
            <h3>Test Execution Progress by Category</h3>
            <div class="table-container">
                <table>
                    <thead>
                        <tr>
                            <th>Test Category</th>
                            <th>Total</th>
                            <th>Passed</th>
                            <th>Failed</th>
                            <th>Blocked</th>
                            <th>Pending</th>
                            <th>Progress</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><strong>SAP Integration</strong></td>
                            <td>5</td>
                            <td id="sap-passed">0</td>
                            <td id="sap-failed">0</td>
                            <td id="sap-blocked">0</td>
                            <td id="sap-pending">5</td>
                            <td id="sap-progress">0%</td>
                        </tr>
                        <tr>
                            <td><strong>Marketing Cloud</strong></td>
                            <td>5</td>
                            <td id="mc-passed">0</td>
                            <td id="mc-failed">0</td>
                            <td id="mc-blocked">0</td>
                            <td id="mc-pending">5</td>
                            <td id="mc-progress">0%</td>
                        </tr>
                        <tr>
                            <td><strong>Dunning Automation</strong></td>
                            <td>5</td>
                            <td id="dun-passed">0</td>
                            <td id="dun-failed">0</td>
                            <td id="dun-blocked">0</td>
                            <td id="dun-pending">5</td>
                            <td id="dun-progress">0%</td>
                        </tr>
                        <tr>
                            <td><strong>Data Loader</strong></td>
                            <td>4</td>
                            <td id="dl-passed">0</td>
                            <td id="dl-failed">0</td>
                            <td id="dl-blocked">0</td>
                            <td id="dl-pending">4</td>
                            <td id="dl-progress">0%</td>
                        </tr>
                        <tr>
                            <td><strong>Error Handling</strong></td>
                            <td>3</td>
                            <td id="eh-passed">0</td>
                            <td id="eh-failed">0</td>
                            <td id="eh-blocked">0</td>
                            <td id="eh-pending">3</td>
                            <td id="eh-progress">0%</td>
                        </tr>
                    </tbody>
                </table>
            </div>
            
            <h3>Daily Test Execution Status</h3>
            <div class="table-container">
                <table>
                    <thead>
                        <tr>
                            <th>Date</th>
                            <th>Planned Test Cases</th>
                            <th>Executed</th>
                            <th>Passed</th>
                            <th>Failed</th>
                            <th>Daily Notes</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><strong>Aug 11, 2025</strong></td>
                            <td>SIT-SAP-001, SIT-SAP-002</td>
                            <td><input type="number" min="0" max="2" value="0" class="daily-executed" data-date="aug11"></td>
                            <td><input type="number" min="0" max="2" value="0" class="daily-passed" data-date="aug11"></td>
                            <td><input type="number" min="0" max="2" value="0" class="daily-failed" data-date="aug11"></td>
                            <td><input type="text" placeholder="Daily notes..." class="daily-notes" data-date="aug11"></td>
                        </tr>
                        <tr>
                            <td><strong>Aug 12, 2025</strong></td>
                            <td>SIT-SAP-003, SIT-DL-001</td>
                            <td><input type="number" min="0" max="2" value="0" class="daily-executed" data-date="aug12"></td>
                            <td><input type="number" min="0" max="2" value="0" class="daily-passed" data-date="aug12"></td>
                            <td><input type="number" min="0" max="2" value="0" class="daily-failed" data-date="aug12"></td>
                            <td><input type="text" placeholder="Daily notes..." class="daily-notes" data-date="aug12"></td>
                        </tr>
                        <tr>
                            <td><strong>Aug 13, 2025</strong></td>
                            <td>SIT-DL-002, SIT-DL-003</td>
                            <td><input type="number" min="0" max="2" value="0" class="daily-executed" data-date="aug13"></td>
                            <td><input type="number" min="0" max="2" value="0" class="daily-passed" data-date="aug13"></td>
                            <td><input type="number" min="0" max="2" value="0" class="daily-failed" data-date="aug13"></td>
                            <td><input type="text" placeholder="Daily notes..." class="daily-notes" data-date="aug13"></td>
                        </tr>
                        <tr>
                            <td><strong>Aug 14, 2025</strong></td>
                            <td>SIT-DL-004, SIT-SAP-004</td>
                            <td><input type="number" min="0" max="2" value="0" class="daily-executed" data-date="aug14"></td>
                            <td><input type="number" min="0" max="2" value="0" class="daily-passed" data-date="aug14"></td>
                            <td><input type="number" min="0" max="2" value="0" class="daily-failed" data-date="aug14"></td>
                            <td><input type="text" placeholder="Daily notes..." class="daily-notes" data-date="aug14"></td>
                        </tr>
                        <tr>
                            <td><strong>Aug 15, 2025</strong></td>
                            <td>SIT-MC-001, SIT-MC-002</td>
                            <td><input type="number" min="0" max="2" value="0" class="daily-executed" data-date="aug15"></td>
                            <td><input type="number" min="0" max="2" value="0" class="daily-passed" data-date="aug15"></td>
                            <td><input type="number" min="0" max="2" value="0" class="daily-failed" data-date="aug15"></td>
                            <td><input type="text" placeholder="Daily notes..." class="daily-notes" data-date="aug15"></td>
                        </tr>
                        <tr>
                            <td><strong>Aug 18, 2025</strong></td>
                            <td>SIT-MC-003, SIT-MC-004</td>
                            <td><input type="number" min="0" max="2" value="0" class="daily-executed" data-date="aug18"></td>
                            <td><input type="number" min="0" max="2" value="0" class="daily-passed" data-date="aug18"></td>
                            <td><input type="number" min="0" max="2" value="0" class="daily-failed" data-date="aug18"></td>
                            <td><input type="text" placeholder="Daily notes..." class="daily-notes" data-date="aug18"></td>
                        </tr>
                        <tr>
                            <td><strong>Aug 19, 2025</strong></td>
                            <td>SIT-MC-005, SIT-DUN-001</td>
                            <td><input type="number" min="0" max="2" value="0" class="daily-executed" data-date="aug19"></td>
                            <td><input type="number" min="0" max="2" value="0" class="daily-passed" data-date="aug19"></td>
                            <td><input type="number" min="0" max="2" value="0" class="daily-failed" data-date="aug19"></td>
                            <td><input type="text" placeholder="Daily notes..." class="daily-notes" data-date="aug19"></td>
                        </tr>
                        <tr>
                            <td><strong>Aug 20, 2025</strong></td>
                            <td>SIT-DUN-002, SIT-DUN-003</td>
                            <td><input type="number" min="0" max="2" value="0" class="daily-executed" data-date="aug20"></td>
                            <td><input type="number" min="0" max="2" value="0" class="daily-passed" data-date="aug20"></td>
                            <td><input type="number" min="0" max="2" value="0" class="daily-failed" data-date="aug20"></td>
                            <td><input type="text" placeholder="Daily notes..." class="daily-notes" data-date="aug20"></td>
                        </tr>
                        <tr>
                            <td><strong>Aug 21, 2025</strong></td>
                            <td>SIT-DUN-004, SIT-DUN-005</td>
                            <td><input type="number" min="0" max="2" value="0" class="daily-executed" data-date="aug21"></td>
                            <td><input type="number" min="0" max="2" value="0" class="daily-passed" data-date="aug21"></td>
                            <td><input type="number" min="0" max="2" value="0" class="daily-failed" data-date="aug21"></td>
                            <td><input type="text" placeholder="Daily notes..." class="daily-notes" data-date="aug21"></td>
                        </tr>
                        <tr>
                            <td><strong>Aug 22, 2025</strong></td>
                            <td>SIT-SAP-005</td>
                            <td><input type="number" min="0" max="1" value="0" class="daily-executed" data-date="aug22"></td>
                            <td><input type="number" min="0" max="1" value="0" class="daily-passed" data-date="aug22"></td>
                            <td><input type="number" min="0" max="1" value="0" class="daily-failed" data-date="aug22"></td>
                            <td><input type="text" placeholder="Daily notes..." class="daily-notes" data-date="aug22"></td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- SAP Integration Tab -->
        <div id="sap-integration" class="tab-content">
            <h2 class="section-header">SAP Integration Test Cases</h2>
            <p>This tab validates the data flow from SAP to Quick Receivables, covering customer, invoice, payment, and adjustment data synchronization.</p>
            
            <div class="test-step">
                <h5>SIT-SAP-001: Verify Customer Master Data Sync (ARCUST)</h5>
                <p><strong>Description:</strong> Verify that new customer master data created in SAP (ARCUST file) is correctly synchronized to Salesforce Quick Receivables as Account records.</p>
                <div class="pre-conditions">
                    <strong>Pre-conditions:</strong> SAP test system accessible. Salesforce org accessible. Node.js script and Data Loader CLI are deployed and running on the Wilscot Shared Folder Server. The Node.js script is actively monitoring the input folder. Integration user configured with necessary permissions in Salesforce.
                </div>
                <div class="test-data">
                    <strong>Test Data:</strong> Prepare an <code>ARCUST</code> flat file (e.g., <code>ARCUSTYYYYMMDD.txt</code> where YYYYMMDD is the current date) containing a new, unique customer record. Example fields: <code>CUSTNO: 99999, NAME: Test Customer Inc., ADDRESS: 123 Test St, City, State, Zip, PHONE: 555-123-4567, EMAIL: test.customer@example.com</code>. Place this file in the monitored server directory.
                </div>
                <div class="expected-result">
                    <strong>Expected Result:</strong>
                    <ol>
                        <li>The Node.js script's console logs indicate detection of the <code>ARCUSTYYYYMMDD.txt</code> file and successful conversion to <code>ARCUST.csv</code>.</li>
                        <li>The Node.js script successfully invokes the Data Loader CLI for <code>ARCUST.csv</code>.</li>
                        <li>A new Account record is created in Salesforce with the provided customer details (e.g., Name, Billing Address, Phone, Email, Customer ID).</li>
                        <li>A corresponding Quick Receivables Customer record is linked to the Account, with accurate SAP Customer ID.</li>
                        <li>The Data Loader success log (e.g., <code>ARCUST_success.csv</code>) indicates successful insertion of the record with its Salesforce ID.</li>
                    </ol>
                </div>
                <div class="test-results-section">
                    <h4>Test Results</h4>
                    <div class="result-grid">
                        <div class="result-field">
                            <label for="sap001-status">Status:</label>
                            <select id="sap001-status" class="status-dropdown" onchange="updateTestStatus('SIT-SAP-001', this.value)">
                                <option value="pending">Pending</option>
                                <option value="passed">Passed</option>
                                <option value="failed">Failed</option>
                                <option value="blocked">Blocked</option>
                                <option value="na">N/A</option>
                            </select>
                        </div>
                        <div class="result-field">
                            <label for="sap001-tester">Executed By:</label>
                            <input type="text" id="sap001-tester" data-testid="SIT-SAP-001" data-field="tester" placeholder="Tester Name">
                        </div>
                        <div class="result-field">
                            <label for="sap001-date">Execution Date:</label>
                            <input type="date" id="sap001-date" data-testid="SIT-SAP-001" data-field="date">
                        </div>
                        <div class="result-field">
                            <label for="sap001-duration">Execution Time (minutes):</label>
                            <input type="number" id="sap001-duration" data-testid="SIT-SAP-001" data-field="duration" min="0">
                        </div>
                        <div class="result-field">
                            <label for="sap001-env">Environment:</label>
                            <input type="text" id="sap001-env" data-testid="SIT-SAP-001" data-field="environment" value="Salesforce Sandbox">
                        </div>
                        <div class="result-field">
                            <label for="sap001-build">Build Version:</label>
                            <input type="text" id="sap001-build" data-testid="SIT-SAP-001" data-field="build" value="1.0.0">
                        </div>
                    </div>
                    <div class="result-field">
                        <label for="sap001-notes">Test Notes / Comments:</label>
                        <textarea id="sap001-notes" data-testid="SIT-SAP-001" data-field="notes" placeholder="Enter any observations or issues..."></textarea>
                    </div>
                    <div class="result-grid">
                        <div class="result-field">
                            <label for="sap001-defect">Defect ID (if failed):</label>
                            <input type="text" id="sap001-defect" data-testid="SIT-SAP-001" data-field="defect" placeholder="JIRA-123">
                        </div>
                        <div class="result-field">
                            <label for="sap001-retest">Retest Required:</label>
                            <select id="sap001-retest" data-testid="SIT-SAP-001" data-field="retest">
                                <option value="">N/A</option>
                                <option value="yes">Yes</option>
                                <option value="no">No</option>
                            </select>
                        </div>
                        <div class="result-field">
                            <label for="sap001-priority">Priority:</label>
                            <select id="sap001-priority" data-testid="SIT-SAP-001" data-field="priority">
                                <option value="critical">Critical</option>
                                <option value="high">High</option>
                                <option value="medium">Medium</option>
                                <option value="low">Low</option>
                            </select>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="test-step">
                <h5>SIT-SAP-002: Verify Invoice Data Sync (ARMAST)</h5>
                <p><strong>Description:</strong> Confirm that invoice data from SAP (ARMAST file) is correctly transferred and reflected as Invoice records in Salesforce Quick Receivables, linked to the correct Account.</p>
                <div class="pre-conditions">
                    <strong>Pre-conditions:</strong> SIT-SAP-001 (Customer Master Data Sync) is successfully completed for the relevant accounts. Node.js script and Data Loader CLI are deployed and running on the Wilscot Shared Folder Server. The Node.js script is actively monitoring the input folder. The <code>ARMAST</code> mapping file (<code>.sdl</code>) is correctly configured to upsert into the Invoice object and link to Account via Customer ID.
                </div>
                <div class="test-data">
                    <strong>Test Data:</strong> Prepare an <code>ARMAST</code> flat file (e.g., <code>ARMASTYYYYMMDD.txt</code> where YYYYMMDD is the current date) with invoice records for an existing customer (e.g., <code>CUSTNO: 99999</code> from SIT-SAP-001). Example fields: <code>CUSTNO: 99999, INVNO: 10001, INVDTE: 20250701, BALANCE: 500.00, PNET: 30, DUEDATE: 20250731, STATUS: OPEN</code>. Place this file in the monitored server directory.
                </div>
                <div class="expected-result">
                    <strong>Expected Result:</strong>
                    <ol>
                        <li>The Node.js script's console logs indicate detection of the <code>ARMASTYYYYMMDD.txt</code> file and successful conversion to <code>ARMAST.csv</code>.</li>
                        <li>The Node.js script successfully invokes the Data Loader CLI for <code>ARMAST.csv</code>.</li>
                        <li>New Invoice records are created in Salesforce linked to the correct Account (matching <code>CUSTNO</code>).</li>
                        <li>Invoice details (e.g., Invoice Number, Invoice Date, Balance, Due Date, Status) match the source data.</li>
                        <li>The Data Loader success log (e.g., <code>ARMAST_success.csv</code>) indicates successful upsertion of the records.</li>
                    </ol>
                </div>
                <div class="test-results-section">
                    <h4>Test Results</h4>
                    <div class="result-grid">
                        <div class="result-field">
                            <label for="sap002-status">Status:</label>
                            <select id="sap002-status" class="status-dropdown" onchange="updateTestStatus('SIT-SAP-002', this.value)">
                                <option value="pending">Pending</option>
                                <option value="passed">Passed</option>
                                <option value="failed">Failed</option>
                                <option value="blocked">Blocked</option>
                                <option value="na">N/A</option>
                            </select>
                        </div>
                        <div class="result-field">
                            <label for="sap002-tester">Executed By:</label>
                            <input type="text" id="sap002-tester" data-testid="SIT-SAP-002" data-field="tester" placeholder="Tester Name">
                        </div>
                        <div class="result-field">
                            <label for="sap002-date">Execution Date:</label>
                            <input type="date" id="sap002-date" data-testid="SIT-SAP-002" data-field="date">
                        </div>
                        <div class="result-field">
                            <label for="sap002-duration">Execution Time (minutes):</label>
                            <input type="number" id="sap002-duration" data-testid="SIT-SAP-002" data-field="duration" min="0">
                        </div>
                        <div class="result-field">
                            <label for="sap002-env">Environment:</label>
                            <input type="text" id="sap002-env" data-testid="SIT-SAP-002" data-field="environment" value="Salesforce Sandbox">
                        </div>
                        <div class="result-field">
                            <label for="sap002-build">Build Version:</label>
                            <input type="text" id="sap002-build" data-testid="SIT-SAP-002" data-field="build" value="1.0.0">
                        </div>
                    </div>
                    <div class="result-field">
                        <label for="sap002-notes">Test Notes / Comments:</label>
                        <textarea id="sap002-notes" data-testid="SIT-SAP-002" data-field="notes" placeholder="Enter any observations or issues..."></textarea>
                    </div>
                    <div class="result-grid">
                        <div class="result-field">
                            <label for="sap002-defect">Defect ID (if failed):</label>
                            <input type="text" id="sap002-defect" data-testid="SIT-SAP-002" data-field="defect" placeholder="JIRA-123">
                        </div>
                        <div class="result-field">
                            <label for="sap002-retest">Retest Required:</label>
                            <select id="sap002-retest" data-testid="SIT-SAP-002" data-field="retest">
                                <option value="">N/A</option>
                                <option value="yes">Yes</option>
                                <option value="no">No</option>
                            </select>
                        </div>
                        <div class="result-field">
                            <label for="sap002-priority">Priority:</label>
                            <select id="sap002-priority" data-testid="SIT-SAP-002" data-field="priority">
                                <option value="critical">Critical</option>
                                <option value="high">High</option>
                                <option value="medium">Medium</option>
                                <option value="low">Low</option>
                            </select>
                        </div>
                    </div>
                </div>
            </div>
            <div class="test-step">
                <h5>SIT-SAP-003: Verify Payment Data Sync (ARCASH)</h5>
                <p><strong>Description:</strong> Ensure payment records from SAP (ARCASH file) are accurately synchronized to Salesforce Quick Receivables as Payment records, and correctly update invoice balances.</p>
                <div class="pre-conditions">
                    <strong>Pre-conditions:</strong> SIT-SAP-002 (Invoice Data Sync) is successfully completed for the relevant invoices. Node.js script and Data Loader CLI are deployed and running on the Wilscot Shared Folder Server. The Node.js script is actively monitoring the input folder. The <code>ARCASH</code> mapping file (<code>.sdl</code>) is correctly configured to upsert into the Payment object and link to Invoice via Invoice Number.
                </div>
                <div class="test-data">
                    <strong>Test Data:</strong> Prepare an <code>ARCASH</code> flat file (e.g., <code>ARCASHYYYYMMDD.txt</code> where YYYYMMDD is the current date) with payment records for an existing invoice (e.g., <code>INVNO: 10001</code> from SIT-SAP-002). Example fields: <code>CUSTNO: 99999, INVNO: 10001, AMOUNT: 500.00, PAYDATE: 20250723, TYPE: FULL</code>. Place this file in the monitored server directory.
                </div>
                <div class="expected-result">
                    <strong>Expected Result:</strong>
                    <ol>
                        <li>The Node.js script's console logs indicate detection of the <code>ARCASHYYYYMMDD.txt</code> file and successful conversion to <code>ARCASH.csv</code>.</li>
                        <li>The Node.js script successfully invokes the Data Loader CLI for <code>ARCASH.csv</code>.</li>
                        <li>New Payment records are created in Salesforce linked to the correct Invoice.</li>
                        <li>The Invoice balance on <code>INVNO: 10001</code> is updated to reflect the payment (e.g., reduced to 0 if full payment).</li>
                        <li>The Data Loader success log (e.g., <code>ARCASH_success.csv</code>) indicates successful upsertion of the records.</li>
                    </ol>
                </div>
                <div class="test-results-section">
                    <h4>Test Results</h4>
                    <div class="result-grid">
                        <div class="result-field">
                            <label for="sap003-status">Status:</label>
                            <select id="sap003-status" class="status-dropdown" onchange="updateTestStatus('SIT-SAP-003', this.value)">
                                <option value="pending">Pending</option>
                                <option value="passed">Passed</option>
                                <option value="failed">Failed</option>
                                <option value="blocked">Blocked</option>
                                <option value="na">N/A</option>
                            </select>
                        </div>
                        <div class="result-field">
                            <label for="sap003-tester">Executed By:</label>
                            <input type="text" id="sap003-tester" data-testid="SIT-SAP-003" data-field="tester" placeholder="Tester Name">
                        </div>
                        <div class="result-field">
                            <label for="sap003-date">Execution Date:</label>
                            <input type="date" id="sap003-date" data-testid="SIT-SAP-003" data-field="date">
                        </div>
                        <div class="result-field">
                            <label for="sap003-duration">Execution Time (minutes):</label>
                            <input type="number" id="sap003-duration" data-testid="SIT-SAP-003" data-field="duration" min="0">
                        </div>
                        <div class="result-field">
                            <label for="sap003-env">Environment:</label>
                            <input type="text" id="sap003-env" data-testid="SIT-SAP-003" data-field="environment" value="Salesforce Sandbox">
                        </div>
                        <div class="result-field">
                            <label for="sap003-build">Build Version:</label>
                            <input type="text" id="sap003-build" data-testid="SIT-SAP-003" data-field="build" value="1.0.0">
                        </div>
                    </div>
                    <div class="result-field">
                        <label for="sap003-notes">Test Notes / Comments:</label>
                        <textarea id="sap003-notes" data-testid="SIT-SAP-003" data-field="notes" placeholder="Enter any observations or issues..."></textarea>
                    </div>
                    <div class="result-grid">
                        <div class="result-field">
                            <label for="sap003-defect">Defect ID (if failed):</label>
                            <input type="text" id="sap003-defect" data-testid="SIT-SAP-003" data-field="defect" placeholder="JIRA-123">
                        </div>
                        <div class="result-field">
                            <label for="sap003-retest">Retest Required:</label>
                            <select id="sap003-retest" data-testid="SIT-SAP-003" data-field="retest">
                                <option value="">N/A</option>
                                <option value="yes">Yes</option>
                                <option value="no">No</option>
                            </select>
                        </div>
                        <div class="result-field">
                            <label for="sap003-priority">Priority:</label>
                            <select id="sap003-priority" data-testid="SIT-SAP-003" data-field="priority">
                                <option value="critical">Critical</option>
                                <option value="high">High</option>
                                <option value="medium">Medium</option>
                                <option value="low">Low</option>
                            </select>
                        </div>
                    </div>
                </div>
            </div>
            <div class="test-step">
                <h5>SIT-SAP-004: Verify Adjustments Data Sync (AREXTI)</h5>
                <p><strong>Description:</strong> Test the synchronization of transaction adjustment data (e.g., credit memos, write-offs) from SAP (AREXTI file) to Quick Receivables, and verify its impact on invoice balances.</p>
                <div class="pre-conditions">
                    <strong>Pre-conditions:</strong> SIT-SAP-002 (Invoice Data Sync) is successfully completed for the relevant invoices. Node.js script and Data Loader CLI are deployed and running on the Wilscot Shared Folder Server. The Node.js script is actively monitoring the input folder. The <code>AREXTI</code> mapping file (<code>.sdl</code>) is correctly configured to upsert/update the Invoice object or create Adjustment records.
                </div>
                <div class="test-data">
                    <strong>Test Data:</strong> Prepare an <code>AREXTI</code> flat file (e.g., <code>AREXTIYYYYMMDD.txt</code> where YYYYMMDD is the current date) with an adjustment record for an existing invoice (e.g., <code>INVNO: 10001</code>). Example fields: <code>CUSTNO: 99999, INVNO: 10001, ADJUSTMENT_TYPE: Credit Memo, AMOUNT: 50.00, ADJUSTMENT_DATE: 20250723</code>. Place this file in the monitored server directory.
                </div>
                <div class="expected-result">
                    <strong>Expected Result:</strong>
                    <ol>
                        <li>The Node.js script's console logs indicate detection of the <code>AREXTIYYYYMMDD.txt</code> file and successful conversion to <code>AREXTI.csv</code>.</li>
                        <li>The Node.js script successfully invokes the Data Loader CLI for <code>AREXTI.csv</code>.</li>
                        <li>The relevant Invoice record in Salesforce (<code>INVNO: 10001</code>) is updated to reflect the adjustment (e.g., balance reduced by credit memo amount).</li>
                        <li>If applicable, a new Adjustment record is created in Salesforce and linked to the Invoice.</li>
                        <li>The Data Loader success log (e.g., <code>AREXTI_success.csv</code>) indicates successful upsertion/update of the records.</li>
                    </ol>
                </div>
                <div class="test-results-section">
                    <h4>Test Results</h4>
                    <div class="result-grid">
                        <div class="result-field">
                            <label for="sap004-status">Status:</label>
                            <select id="sap004-status" class="status-dropdown" onchange="updateTestStatus('SIT-SAP-004', this.value)">
                                <option value="pending">Pending</option>
                                <option value="passed">Passed</option>
                                <option value="failed">Failed</option>
                                <option value="blocked">Blocked</option>
                                <option value="na">N/A</option>
                            </select>
                        </div>
                        <div class="result-field">
                            <label for="sap004-tester">Executed By:</label>
                            <input type="text" id="sap004-tester" data-testid="SIT-SAP-004" data-field="tester" placeholder="Tester Name">
                        </div>
                        <div class="result-field">
                            <label for="sap004-date">Execution Date:</label>
                            <input type="date" id="sap004-date" data-testid="SIT-SAP-004" data-field="date">
                        </div>
                        <div class="result-field">
                            <label for="sap004-duration">Execution Time (minutes):</label>
                            <input type="number" id="sap004-duration" data-testid="SIT-SAP-004" data-field="duration" min="0">
                        </div>
                        <div class="result-field">
                            <label for="sap004-env">Environment:</label>
                            <input type="text" id="sap004-env" data-testid="SIT-SAP-004" data-field="environment" value="Salesforce Sandbox">
                        </div>
                        <div class="result-field">
                            <label for="sap004-build">Build Version:</label>
                            <input type="text" id="sap004-build" data-testid="SIT-SAP-004" data-field="build" value="1.0.0">
                        </div>
                    </div>
                    <div class="result-field">
                        <label for="sap004-notes">Test Notes / Comments:</label>
                        <textarea id="sap004-notes" data-testid="SIT-SAP-004" data-field="notes" placeholder="Enter any observations or issues..."></textarea>
                    </div>
                    <div class="result-grid">
                        <div class="result-field">
                            <label for="sap004-defect">Defect ID (if failed):</label>
                            <input type="text" id="sap004-defect" data-testid="SIT-SAP-004" data-field="defect" placeholder="JIRA-123">
                        </div>
                        <div class="result-field">
                            <label for="sap004-retest">Retest Required:</label>
                            <select id="sap004-retest" data-testid="SIT-SAP-004" data-field="retest">
                                <option value="">N/A</option>
                                <option value="yes">Yes</option>
                                <option value="no">No</option>
                            </select>
                        </div>
                        <div class="result-field">
                            <label for="sap004-priority">Priority:</label>
                            <select id="sap004-priority" data-testid="SIT-SAP-004" data-field="priority">
                                <option value="critical">Critical</option>
                                <option value="high">High</option>
                                <option value="medium">Medium</option>
                                <option value="low">Low</option>
                            </select>
                        </div>
                    </div>
                </div>
            </div>
            <div class="test-step">
                <h5>SIT-SAP-005: Error Handling - Invalid Customer ID Sync</h5>
                <p><strong>Description:</strong> Test how the system handles synchronization of customer data with invalid or malformed IDs from SAP, ensuring errors are logged and valid records are not impacted.</p>
                <div class="pre-conditions">
                    <strong>Pre-conditions:</strong> Node.js script and Data Loader CLI are deployed and running on the Wilscot Shared Folder Server. The Node.js script is actively monitoring the input folder and configured for error logging and email notification.
                </div>
                <div class="test-data">
                    <strong>Test Data:</strong> Prepare an <code>ARCUST</code> flat file (e.g., <code>ARCUSTYYYYMMDD.txt</code> where YYYYMMDD is the current date) containing a mix of valid customer records and intentionally invalid records:
                    <ul>
                        <li>One record with a non-numeric <code>CUSTNO</code> (e.g., <code>CUSTNO: ABCDE</code>).</li>
                        <li>One record with a duplicate <code>CUSTNO</code> that already exists in Salesforce and violates uniqueness rules.</li>
                        <li>One record with a missing required field (e.g., <code>NAME</code> is empty).</li>
                    </ul>
                    Place this file in the monitored server directory.
                </div>
                <div class="expected-result">
                    <strong>Expected Result:</strong>
                    <ol>
                        <li>The Node.js script's console/error logs capture parsing/processing errors for the malformed records.</li>
                        <li>The Data Loader error log (e.g., <code>ARCUST_error.csv</code>) contains entries for the invalid records, detailing the reason for failure (e.g., "Invalid ID", "Duplicate Value", "Required field missing").</li>
                        <li>Valid customer records in the same file are successfully created/updated in Salesforce.</li>
                        <li>No new Account record is created in Salesforce for the invalid customer IDs.</li>
                        <li>An email alert is sent to the configured recipient with the <code>ARCUST_error.csv</code> log file attached.</li>
                    </ol>
                </div>
                <div class="test-results-section">
                    <h4>Test Results</h4>
                    <div class="result-grid">
                        <div class="result-field">
                            <label for="sap005-status">Status:</label>
                            <select id="sap005-status" class="status-dropdown" onchange="updateTestStatus('SIT-SAP-005', this.value)">
                                <option value="pending">Pending</option>
                                <option value="passed">Passed</option>
                                <option value="failed">Failed</option>
                                <option value="blocked">Blocked</option>
                                <option value="na">N/A</option>
                            </select>
                        </div>
                        <div class="result-field">
                            <label for="sap005-tester">Executed By:</label>
                            <input type="text" id="sap005-tester" data-testid="SIT-SAP-005" data-field="tester" placeholder="Tester Name">
                        </div>
                        <div class="result-field">
                            <label for="sap005-date">Execution Date:</label>
                            <input type="date" id="sap005-date" data-testid="SIT-SAP-005" data-field="date">
                        </div>
                        <div class="result-field">
                            <label for="sap005-duration">Execution Time (minutes):</label>
                            <input type="number" id="sap005-duration" data-testid="SIT-SAP-005" data-field="duration" min="0">
                        </div>
                        <div class="result-field">
                            <label for="sap005-env">Environment:</label>
                            <input type="text" id="sap005-env" data-testid="SIT-SAP-005" data-field="environment" value="Salesforce Sandbox">
                        </div>
                        <div class="result-field">
                            <label for="sap005-build">Build Version:</label>
                            <input type="text" id="sap005-build" data-testid="SIT-SAP-005" data-field="build" value="1.0.0">
                        </div>
                    </div>
                    <div class="result-field">
                        <label for="sap005-notes">Test Notes / Comments:</label>
                        <textarea id="sap005-notes" data-testid="SIT-SAP-005" data-field="notes" placeholder="Enter any observations or issues..."></textarea>
                    </div>
                    <div class="result-grid">
                        <div class="result-field">
                            <label for="sap005-defect">Defect ID (if failed):</label>
                            <input type="text" id="sap005-defect" data-testid="SIT-SAP-005" data-field="defect" placeholder="JIRA-123">
                        </div>
                        <div class="result-field">
                            <label for="sap005-retest">Retest Required:</label>
                            <select id="sap005-retest" data-testid="SIT-SAP-005" data-field="retest">
                                <option value="">N/A</option>
                                <option value="yes">Yes</option>
                                <option value="no">No</option>
                            </select>
                        </div>
                        <div class="result-field">
                            <label for="sap005-priority">Priority:</label>
                            <select id="sap005-priority" data-testid="SIT-SAP-005" data-field="priority">
                                <option value="critical">Critical</option>
                                <option value="high">High</option>
                                <option value="medium">Medium</option>
                                <option value="low">Low</option>
                            </select>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Marketing Cloud Tab -->
        <div id="marketing-cloud" class="tab-content">
            <h2 class="section-header">Marketing Cloud Integration Test Cases</h2>
            <p>This tab verifies dunning email automation and tracking through Salesforce Marketing Cloud Connect, including email triggers, personalization, and suppression.</p>
            
            <div class="test-step">
                <h5>SIT-MC-001: Verify Dunning Email Trigger for Overdue Invoice (Friendly Reminder)</h5>
                <p><strong>Description:</strong> Confirm that an invoice becoming 1 day past due (DPD) correctly triggers the "Friendly Reminder" dunning email from Marketing Cloud via Journey Builder.</p>
                <div class="pre-conditions">
                    <strong>Pre-conditions:</strong> Salesforce Marketing Cloud Connect is fully configured and actively syncing `Account` (Name, Total Balance, Total Past Due), `Contact` (Name, Email, Primary Contact), and `Invoice` (Transaction Number, Amount, Due Amount, Purchase Order, Invoice Date, Due Date, Assigned Collector Name, Assigned Collector Phone) data from Salesforce to Marketing Cloud Data Extensions. The "Friendly Reminder" journey in Journey Builder is active and configured to trigger for invoices 1 day after their Due Date. Email Studio is set up with the "Friendly Reminder" email template.
                </div>
                <div class="test-data">
                    <strong>Test Data:</strong>
                    <ol>
                        <li>Create an Account record in Salesforce (e.g., "MC Test Account 001").</li>
                        <li>Create a Contact record linked to "MC Test Account 001" with a valid, accessible email address (e.g., `test.mc.user@example.com`) and `Primary Contact = true`.</li>
                        <li>Create an Invoice record for "MC Test Account 001" with the following details:
                            <ul>
                                <li><code>Due Date</code>: Set to yesterday's date (to make it 1 day past due today).</li>
                                <li><code>Amount</code>: e.g., $150.00</li>
                                <li><code>Due Amount</code>: e.g., $150.00</li>
                                <li><code>Transaction Number</code>: e.g., INV-MC-001</li>
                                <li>Ensure `Assigned Collector Name` and `Assigned Collector Phone` are populated.</li>
                            </ul>
                        </li>
                        <li>Allow time for Marketing Cloud Connect to sync the new/updated Salesforce records to the relevant Data Extensions.</li>
                    </ol>
                </div>
                <div class="expected-result">
                    <strong>Expected Result:</strong>
                    <ol>
                        <li>The "Friendly Reminder" email is sent to `test.mc.user@example.com` (or the configured Contact email) via Marketing Cloud.</li>
                        <li>Verify the received email's content matches the "Friendly Reminder" template in Email Studio.</li>
                        <li>Confirm that personalized fields in the email (e.g., Customer Name, Invoice Number: INV-MC-001, Due Amount: $150.00, Due Date, Assigned Collector Name, Assigned Collector Phone) are accurately populated from the Salesforce record.</li>
                        <li>An Individual Email Result (IER) record is created/updated in Salesforce, associated with the Contact and/or Invoice, indicating the email was successfully sent.</li>
                    </ol>
                </div>
                <div class="test-results-section">
                    <h4>Test Results</h4>
                    <div class="result-grid">
                        <div class="result-field">
                            <label for="mc001-status">Status:</label>
                            <select id="mc001-status" class="status-dropdown" onchange="updateTestStatus('SIT-MC-001', this.value)">
                                <option value="pending">Pending</option>
                                <option value="passed">Passed</option>
                                <option value="failed">Failed</option>
                                <option value="blocked">Blocked</option>
                                <option value="na">N/A</option>
                            </select>
                        </div>
                        <div class="result-field">
                            <label for="mc001-tester">Executed By:</label>
                            <input type="text" id="mc001-tester" data-testid="SIT-MC-001" data-field="tester" placeholder="Tester Name">
                        </div>
                        <div class="result-field">
                            <label for="mc001-date">Execution Date:</label>
                            <input type="date" id="mc001-date" data-testid="SIT-MC-001" data-field="date">
                        </div>
                        <div class="result-field">
                            <label for="mc001-duration">Execution Time (minutes):</label>
                            <input type="number" id="mc001-duration" data-testid="SIT-MC-001" data-field="duration" min="0">
                        </div>
                        <div class="result-field">
                            <label for="mc001-env">Environment:</label>
                            <input type="text" id="mc001-env" data-testid="SIT-MC-001" data-field="environment" value="Salesforce Sandbox">
                        </div>
                        <div class="result-field">
                            <label for="mc001-build">Build Version:</label>
                            <input type="text" id="mc001-build" data-testid="SIT-MC-001" data-field="build" value="1.0.0">
                        </div>
                    </div>
                    <div class="result-field">
                        <label for="mc001-notes">Test Notes / Comments:</label>
                        <textarea id="mc001-notes" data-testid="SIT-MC-001" data-field="notes" placeholder="Enter any observations or issues..."></textarea>
                    </div>
                    <div class="result-grid">
                        <div class="result-field">
                            <label for="mc001-defect">Defect ID (if failed):</label>
                            <input type="text" id="mc001-defect" data-testid="SIT-MC-001" data-field="defect" placeholder="JIRA-123">
                        </div>
                        <div class="result-field">
                            <label for="mc001-retest">Retest Required:</label>
                            <select id="mc001-retest" data-testid="SIT-MC-001" data-field="retest">
                                <option value="">N/A</option>
                                <option value="yes">Yes</option>
                                <option value="no">No</option>
                            </select>
                        </div>
                        <div class="result-field">
                            <label for="mc001-priority">Priority:</label>
                            <select id="mc001-priority" data-testid="SIT-MC-001" data-field="priority">
                                <option value="critical">Critical</option>
                                <option value="high">High</option>
                                <option value="medium">Medium</option>
                                <option value="low">Low</option>
                            </select>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="test-step">
                <h5>SIT-MC-002: Verify Email Opt-Out Synchronization</h5>
                <p><strong>Description:</strong> Test that customer opt-out preferences in Salesforce (Contact object) are synchronized to Marketing Cloud and prevent further dunning emails from being sent to that contact.</p>
                <div class="pre-conditions">
                    <strong>Pre-conditions:</strong> Marketing Cloud Connect is configured for `Contact` synchronization to a relevant Data Extension. An active dunning journey (e.g., "First Notice" at 7 DPD) is configured in Journey Builder.
                </div>
                <div class="test-data">
                    <strong>Test Data:</strong>
                    <ol>
                        <li>Create an Account and Contact with a valid email address (e.g., `optout.test@example.com`).</li>
                        <li>Create an Invoice record for this Account/Contact that will trigger the "Friendly Reminder" email (1 DPD).</li>
                        <li>Verify the "Friendly Reminder" email is successfully sent to `optout.test@example.com`.</li>
                        <li>In Salesforce, navigate to the Contact record for `optout.test@example.com` and set the `Email Opt Out` field to `true`.</li>
                        <li>Allow time for Marketing Cloud Connect to sync the updated `Email Opt Out` status to Marketing Cloud.</li>
                        <li>Advance time or trigger the next dunning cycle (e.g., 7 Days Past Due for "First Notice").</li>
                    </ol>
                </div>
                <div class="expected-result">
                    <strong>Expected Result:</strong>
                    <ol>
                        <li>The Contact's `Email Opt Out` status is successfully synchronized from Salesforce to the corresponding subscriber/data extension record in Marketing Cloud.</li>
                        <li>No further dunning emails (specifically, the "First Notice" email) are sent to the opted-out contact (`optout.test@example.com`).</li>
                        <li>Marketing Cloud reports (e.g., Journey Analytics) show that the subscriber exited the journey or the email send was suppressed due to the opt-out status.</li>
                        <li>The Individual Email Result (IER) record in Salesforce for the "First Notice" email (if attempted) reflects a suppressed or non-delivery status, or no IER record is created for the suppressed send.</li>
                    </ol>
                </div>
                <div class="test-results-section">
                    <h4>Test Results</h4>
                    <div class="result-grid">
                        <div class="result-field">
                            <label for="mc002-status">Status:</label>
                            <select id="mc002-status" class="status-dropdown" onchange="updateTestStatus('SIT-MC-002', this.value)">
                                <option value="pending">Pending</option>
                                <option value="passed">Passed</option>
                                <option value="failed">Failed</option>
                                <option value="blocked">Blocked</option>
                                <option value="na">N/A</option>
                            </select>
                        </div>
                        <div class="result-field">
                            <label for="mc002-tester">Executed By:</label>
                            <input type="text" id="mc002-tester" data-testid="SIT-MC-002" data-field="tester" placeholder="Tester Name">
                        </div>
                        <div class="result-field">
                            <label for="mc002-date">Execution Date:</label>
                            <input type="date" id="mc002-date" data-testid="SIT-MC-002" data-field="date">
                        </div>
                        <div class="result-field">
                            <label for="mc002-duration">Execution Time (minutes):</label>
                            <input type="number" id="mc002-duration" data-testid="SIT-MC-002" data-field="duration" min="0">
                        </div>
                        <div class="result-field">
                            <label for="mc002-env">Environment:</label>
                            <input type="text" id="mc002-env" data-testid="SIT-MC-002" data-field="environment" value="Salesforce Sandbox">
                        </div>
                        <div class="result-field">
                            <label for="mc002-build">Build Version:</label>
                            <input type="text" id="mc002-build" data-testid="SIT-MC-002" data-field="build" value="1.0.0">
                        </div>
                    </div>
                    <div class="result-field">
                        <label for="mc002-notes">Test Notes / Comments:</label>
                        <textarea id="mc002-notes" data-testid="SIT-MC-002" data-field="notes" placeholder="Enter any observations or issues..."></textarea>
                    </div>
                    <div class="result-grid">
                        <div class="result-field">
                            <label for="mc002-defect">Defect ID (if failed):</label>
                            <input type="text" id="mc002-defect" data-testid="SIT-MC-002" data-field="defect" placeholder="JIRA-123">
                        </div>
                        <div class="result-field">
                            <label for="mc002-retest">Retest Required:</label>
                            <select id="mc002-retest" data-testid="SIT-MC-002" data-field="retest">
                                <option value="">N/A</option>
                                <option value="yes">Yes</option>
                                <option value="no">No</option>
                            </select>
                        </div>
                        <div class="result-field">
                            <label for="mc002-priority">Priority:</label>
                            <select id="mc002-priority" data-testid="SIT-MC-002" data-field="priority">
                                <option value="critical">Critical</option>
                                <option value="high">High</option>
                                <option value="medium">Medium</option>
                                <option value="low">Low</option>
                            </select>
                        </div>
                    </div>
                </div>
            </div>
            <div class="test-step">
                <h5>SIT-MC-003: Verify Dunning Email Content Personalization</h5>
                <p><strong>Description:</strong> Check that dunning emails sent from Marketing Cloud include correct personalized data pulled from Salesforce (e.g., customer name, invoice amount, invoice number, due date, assigned collector details).</p>
                <div class="pre-conditions">
                    <strong>Pre-conditions:</strong> Marketing Cloud Connect is configured to sync `Account` (Name), `Contact` (Name, Email), and `Invoice` (Transaction Number, Amount, Due Amount, Due Date, Assigned Collector Name, Assigned Collector Phone) data to relevant Data Extensions in Marketing Cloud. Dunning email templates in Email Studio (e.g., "Friendly Reminder", "First Notice") use personalization strings (e.g., AMPscript or Handlebars) to pull data from these synchronized Data Extensions.
                </div>
                <div class="test-data">
                    <strong>Test Data:</strong>
                    <ol>
                        <li>Create an Account (e.g., "MC Personalization Test Account").</li>
                        <li>Create a Contact linked to this Account with a unique test email (e.g., `personalization.test@example.com`).</li>
                        <li>Create an Invoice record for "MC Personalization Test Account" with specific, easily identifiable details:
                            <ul>
                                <li><code>Invoice Number</code>: `INV-MC-003-ABC`</li>
                                <li><code>Amount</code>: `$999.99`</li>
                                <li><code>Due Date</code>: Set to trigger a dunning email (e.g., 1 day past due).</li>
                                <li><code>Assigned Collector Name</code>: `John Doe`</li>
                                <li><code>Assigned Collector Phone</code>: `(555) 555-1234`</li>
                            </ul>
                        </li>
                        <li>Trigger the relevant dunning email (e.g., "Friendly Reminder") for this invoice.</li>
                    </ol>
                </div>
                <div class="expected-result">
                    <strong>Expected Result:</strong>
                    <ol>
                        <li>The received dunning email (e.g., at `personalization.test@example.com`) displays the correct:
                            <ul>
                                <li>Customer Name (from Account/Contact)</li>
                                <li>Invoice Number: `INV-MC-003-ABC`</li>
                                <li>Due Amount: `$999.99`</li>
                                <li>Invoice Due Date</li>
                                <li>Assigned Collector Name: `John Doe`</li>
                                <li>Assigned Collector Phone: `(555) 555-1234`</li>
                            </ul>
                        </li>
                        <li>All personalized fields in the email are accurately populated, are not blank, and do not show fallback values (unless specifically configured and expected).</li>
                    </ol>
                </div>
                <div class="test-results-section">
                    <h4>Test Results</h4>
                    <div class="result-grid">
                        <div class="result-field">
                            <label for="mc003-status">Status:</label>
                            <select id="mc003-status" class="status-dropdown" onchange="updateTestStatus('SIT-MC-003', this.value)">
                                <option value="pending">Pending</option>
                                <option value="passed">Passed</option>
                                <option value="failed">Failed</option>
                                <option value="blocked">Blocked</option>
                                <option value="na">N/A</option>
                            </select>
                        </div>
                        <div class="result-field">
                            <label for="mc003-tester">Executed By:</label>
                            <input type="text" id="mc003-tester" data-testid="SIT-MC-003" data-field="tester" placeholder="Tester Name">
                        </div>
                        <div class="result-field">
                            <label for="mc003-date">Execution Date:</label>
                            <input type="date" id="mc003-date" data-testid="SIT-MC-003" data-field="date">
                        </div>
                        <div class="result-field">
                            <label for="mc003-duration">Execution Time (minutes):</label>
                            <input type="number" id="mc003-duration" data-testid="SIT-MC-003" data-field="duration" min="0">
                        </div>
                        <div class="result-field">
                            <label for="mc003-env">Environment:</label>
                            <input type="text" id="mc003-env" data-testid="SIT-MC-003" data-field="environment" value="Salesforce Sandbox">
                        </div>
                        <div class="result-field">
                            <label for="mc003-build">Build Version:</label>
                            <input type="text" id="mc003-build" data-testid="SIT-MC-003" data-field="build" value="1.0.0">
                        </div>
                    </div>
                    <div class="result-field">
                        <label for="mc003-notes">Test Notes / Comments:</label>
                        <textarea id="mc003-notes" data-testid="SIT-MC-003" data-field="notes" placeholder="Enter any observations or issues..."></textarea>
                    </div>
                    <div class="result-grid">
                        <div class="result-field">
                            <label for="mc003-defect">Defect ID (if failed):</label>
                            <input type="text" id="mc003-defect" data-testid="SIT-MC-003" data-field="defect" placeholder="JIRA-123">
                        </div>
                        <div class="result-field">
                            <label for="mc003-retest">Retest Required:</label>
                            <select id="mc003-retest" data-testid="SIT-MC-003" data-field="retest">
                                <option value="">N/A</option>
                                <option value="yes">Yes</option>
                                <option value="no">No</option>
                            </select>
                        </div>
                        <div class="result-field">
                            <label for="mc003-priority">Priority:</label>
                            <select id="mc003-priority" data-testid="SIT-MC-003" data-field="priority">
                                <option value="critical">Critical</option>
                                <option value="high">High</option>
                                <option value="medium">Medium</option>
                                <option value="low">Low</option>
                            </select>
                        </div>
                    </div>
                </div>
            </div>
            <div class="test-step">
                <h5>SIT-MC-004: Verify Email Click Tracking in Salesforce (IER)</h5>
                <p><strong>Description:</strong> Test that clicks within dunning emails are correctly tracked in Marketing Cloud and reflected in Salesforce via the Individual Email Result (IER) object.</p>
                <div class="pre-conditions">
                    <strong>Pre-conditions:</strong> Marketing Cloud Connect is configured to push Individual Email Result (IER) data back to Salesforce. A dunning email (e.g., "Friendly Reminder" or "First Notice") has been successfully sent to a test contact with clickable links (e.g., "View Invoice", "Pay Now").
                </div>
                <div class="test-data">
                    <strong>Test Data:</strong>
                    <ol>
                        <li>Ensure a test Account and Contact exist with a valid email.</li>
                        <li>Create an Invoice record that triggers a dunning email (e.g., "Friendly Reminder") to the test contact.</li>
                        <li>Receive the dunning email for the test invoice in the test contact's inbox.</li>
                        <li>Click on at least one link within the received email (e.g., the "View Invoice" link).</li>
                        <li>Allow time for Marketing Cloud to process the click event and for MC Connect to sync the IER data back to Salesforce.</li>
                    </ol>
                </div>
                <div class="expected-result">
                    <strong>Expected Result:</strong>
                    <ol>
                        <li>Within Marketing Cloud (Email Studio Tracking or Journey Analytics), the email's tracking report for the specific send shows a recorded "Click" event for the link that was clicked.</li>
                        <li>An Individual Email Result (IER) record is created or updated in Salesforce, associated with the Contact and/or Invoice.</li>
                        <li>The IER record in Salesforce reflects the click activity:
                            <ul>
                                <li>The `Clicked` field (or equivalent) is `true`.</li>
                                <li>The `ClickDate` (or equivalent) field is populated with the timestamp of the click.</li>
                                <li>Details about the specific URL clicked may also be present if configured.</li>
                            </ul>
                        </li>
                    </ol>
                </div>
                <div class="test-results-section">
                    <h4>Test Results</h4>
                    <div class="result-grid">
                        <div class="result-field">
                            <label for="mc004-status">Status:</label>
                            <select id="mc004-status" class="status-dropdown" onchange="updateTestStatus('SIT-MC-004', this.value)">
                                <option value="pending">Pending</option>
                                <option value="passed">Passed</option>
                                <option value="failed">Failed</option>
                                <option value="blocked">Blocked</option>
                                <option value="na">N/A</option>
                            </select>
                        </div>
                        <div class="result-field">
                            <label for="mc004-tester">Executed By:</label>
                            <input type="text" id="mc004-tester" data-testid="SIT-MC-004" data-field="tester" placeholder="Tester Name">
                        </div>
                        <div class="result-field">
                            <label for="mc004-date">Execution Date:</label>
                            <input type="date" id="mc004-date" data-testid="SIT-MC-004" data-field="date">
                        </div>
                        <div class="result-field">
                            <label for="mc004-duration">Execution Time (minutes):</label>
                            <input type="number" id="mc004-duration" data-testid="SIT-MC-004" data-field="duration" min="0">
                        </div>
                        <div class="result-field">
                            <label for="mc004-env">Environment:</label>
                            <input type="text" id="mc004-env" data-testid="SIT-MC-004" data-field="environment" value="Salesforce Sandbox">
                        </div>
                        <div class="result-field">
                            <label for="mc004-build">Build Version:</label>
                            <input type="text" id="mc004-build" data-testid="SIT-MC-004" data-field="build" value="1.0.0">
                        </div>
                    </div>
                    <div class="result-field">
                        <label for="mc004-notes">Test Notes / Comments:</label>
                        <textarea id="mc004-notes" data-testid="SIT-MC-004" data-field="notes" placeholder="Enter any observations or issues..."></textarea>
                    </div>
                    <div class="result-grid">
                        <div class="result-field">
                            <label for="mc004-defect">Defect ID (if failed):</label>
                            <input type="text" id="mc004-defect" data-testid="SIT-MC-004" data-field="defect" placeholder="JIRA-123">
                        </div>
                        <div class="result-field">
                            <label for="mc004-retest">Retest Required:</label>
                            <select id="mc004-retest" data-testid="SIT-MC-004" data-field="retest">
                                <option value="">N/A</option>
                                <option value="yes">Yes</option>
                                <option value="no">No</option>
                            </select>
                        </div>
                        <div class="result-field">
                            <label for="mc004-priority">Priority:</label>
                            <select id="mc004-priority" data-testid="SIT-MC-004" data-field="priority">
                                <option value="critical">Critical</option>
                                <option value="high">High</option>
                                <option value="medium">Medium</option>
                                <option value="low">Low</option>
                            </select>
                        </div>
                    </div>
                </div>
            </div>
            <div class="test-step">
                <h5>SIT-MC-005: Verify Dunning Email Suppression on Payment</h5>
                <p><strong>Description:</strong> Confirm that a dunning email journey is correctly suppressed if payment is received for an overdue invoice before the next scheduled email is sent.</p>
                <div class="pre-conditions">
                    <strong>Pre-conditions:</strong> SIT-SAP-003 (Payment Data Sync) is functional and ensures timely updates of invoice balances in Salesforce. Marketing Cloud Connect is configured for real-time or near real-time data synchronization of Invoice data to Marketing Cloud Data Extensions. An active dunning journey is configured in Journey Builder with multiple stages (e.g., "Friendly Reminder" at 1 DPD, "First Notice" at 7 DPD).
                </div>
                <div class="test-data">
                    <strong>Test Data:</strong>
                    <ol>
                        <li>Create an Account and Contact with a valid email.</li>
                        <li>Create an Invoice record that will trigger the "Friendly Reminder" email (1 DPD) for this Account/Contact.</li>
                        <li>Verify the "Friendly Reminder" email is successfully sent.</li>
                        <li>Before the trigger for the next dunning email (e.g., "First Notice" at 7 DPD), apply a full payment to the invoice in SAP (e.g., via `ARCASH` file), ensuring the payment syncs to Salesforce and updates the Invoice's `Due Amount` to $0.00.</li>
                        <li>Allow time for the updated Invoice data to sync from Salesforce to Marketing Cloud.</li>
                        <li>Advance time or wait for the scheduled trigger for the "First Notice" email.</li>
                    </ol>
                </div>
                <div class="expected-result">
                    <strong>Expected Result:</strong>
                    <ol>
                        <li>The subsequent dunning email (e.g., "First Notice") is NOT sent to the customer.</li>
                        <li>Within Marketing Cloud (Journey Analytics), the customer's journey status shows they exited the journey or the email send was suppressed due to the payment event (e.g., `Due Amount = 0`).</li>
                        <li>No new Individual Email Result (IER) record is created in Salesforce for the suppressed "First Notice" email, or an existing IER record (if any was pre-created for the stage) indicates a suppressed or non-delivery status.</li>
                    </ol>
                </div>
                <div class="test-results-section">
                    <h4>Test Results</h4>
                    <div class="result-grid">
                        <div class="result-field">
                            <label for="mc005-status">Status:</label>
                            <select id="mc005-status" class="status-dropdown" onchange="updateTestStatus('SIT-MC-005', this.value)">
                                <option value="pending">Pending</option>
                                <option value="passed">Passed</option>
                                <option value="failed">Failed</option>
                                <option value="blocked">Blocked</option>
                                <option value="na">N/A</option>
                            </select>
                        </div>
                        <div class="result-field">
                            <label for="mc005-tester">Executed By:</label>
                            <input type="text" id="mc005-tester" data-testid="SIT-MC-005" data-field="tester" placeholder="Tester Name">
                        </div>
                        <div class="result-field">
                            <label for="mc005-date">Execution Date:</label>
                            <input type="date" id="mc005-date" data-testid="SIT-MC-005" data-field="date">
                        </div>
                        <div class="result-field">
                            <label for="mc005-duration">Execution Time (minutes):</label>
                            <input type="number" id="mc005-duration" data-testid="SIT-MC-005" data-field="duration" min="0">
                        </div>
                        <div class="result-field">
                            <label for="mc005-env">Environment:</label>
                            <input type="text" id="mc005-env" data-testid="SIT-MC-005" data-field="environment" value="Salesforce Sandbox">
                        </div>
                        <div class="result-field">
                            <label for="mc005-build">Build Version:</label>
                            <input type="text" id="mc005-build" data-testid="SIT-MC-005" data-field="build" value="1.0.0">
                        </div>
                    </div>
                    <div class="result-field">
                        <label for="mc005-notes">Test Notes / Comments:</label>
                        <textarea id="mc005-notes" data-testid="SIT-MC-005" data-field="notes" placeholder="Enter any observations or issues..."></textarea>
                    </div>
                    <div class="result-grid">
                        <div class="result-field">
                            <label for="mc005-defect">Defect ID (if failed):</label>
                            <input type="text" id="mc005-defect" data-testid="SIT-MC-005" data-field="defect" placeholder="JIRA-123">
                        </div>
                        <div class="result-field">
                            <label for="mc005-retest">Retest Required:</label>
                            <select id="mc005-retest" data-testid="SIT-MC-005" data-field="retest">
                                <option value="">N/A</option>
                                <option value="yes">Yes</option>
                                <option value="no">No</option>
                            </select>
                        </div>
                        <div class="result-field">
                            <label for="mc005-priority">Priority:</label>
                            <select id="mc005-priority" data-testid="SIT-MC-005" data-field="priority">
                                <option value="critical">Critical</option>
                                <option value="high">High</option>
                                <option value="medium">Medium</option>
                                <option value="low">Low</option>
                            </select>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Dunning Automation Tab -->
        <div id="dunning-automation" class="tab-content">
            <h2 class="section-header">Dunning Automation Test Cases</h2>
            <p>This tab focuses on the automated dunning task creation in Salesforce, verifying CMDT configuration, task generation, and dunning cycle progression.</p>
            
            <div class="test-step">
                <h5>SIT-DUN-001: Verify Dunning Task Creation for 10 DPD</h5>
                <p><strong>Description:</strong> Confirm that when an invoice reaches 10 Days Past Due (DPD), a single dunning task is created per Account, as configured in the <code>DunningTaskConfiguration__mdt</code> Custom Metadata Type.</p>
                <div class="pre-conditions">
                    <strong>Pre-conditions:</strong>
                    <ol>
                        <li>Salesforce org accessible with Quick Receivables and Dunning Automation components deployed.</li>
                        <li>The `DunningTaskConfiguration__mdt` record for 10 DPD is active and correctly configured with:
                            <ul>
                                <li>`DPD__c = 10`</li>
                                <li>`Task_Subject__c = "Follow up on 10 DPD Invoice"`</li>
                                <li>`Owner_Type__c = "Collector"`</li>
                                <li>`Is_Active__c = true`</li>
                            </ul>
                        </li>
                        <li>The Apex Batch for dunning task creation is scheduled to run daily (e.g., via a scheduled job).</li>
                        <li>The integration user has necessary permissions to create Tasks and update Invoice records.</li>
                    </ol>
                </div>
                <div class="test-data">
                    <strong>Test Data:</strong>
                    <ol>
                        <li>Create a new Account (e.g., "DUN Test Account 001") with an `OwnerId` assigned to a known Collector user.</li>
                        <li>Create one or more Invoice records for "DUN Test Account 001" with a `Due Date` that makes them exactly 10 Days Past Due on the day the Apex batch is expected to run. Ensure `DPD__c` on these invoices will be 10, and `Last_DPD_Task_Created__c` is less than 10 (e.g., null or 0).</li>
                        <li>Ensure no payments are applied to these invoices before the batch runs.</li>
                    </ol>
                </div>
                <div class="expected-result">
                    <strong>Expected Result:</strong>
                    <ol>
                        <li>After the Apex batch runs, exactly one Task record is created in Salesforce related to "DUN Test Account 001".</li>
                        <li>The created Task has:
                            <ul>
                                <li>`Subject`: Matches "Follow up on 10 DPD Invoice" (from `Task_Subject__c` in CMDT).</li>
                                <li>`Owner`: Set to the `Account.OwnerId` (the Collector user).</li>
                                <li>`ActivityDate`: Today's date.</li>
                                <li>`WhatId`: Related to "DUN Test Account 001".</li>
                                <li>`Comment`: Includes all related invoice numbers (e.g., "Invoice(s): INV-001, INV-002").</li>
                            </ul>
                        </li>
                        <li>The `Last_DPD_Task_Created__c` field on all related Invoice records for "DUN Test Account 001" is updated to `10`.</li>
                        <li>A `Dunning_Task_Run_Log__c` custom object record is created for the batch run with:
                            <ul>
                                <li>`Execution_Date__c`: Timestamp of batch run.</li>
                                <li>`Total_Invoices_Scanned__c`: Correct count of invoices queried.</li>
                                <li>`Total_Tasks_Created__c`: `1` (or correct count if multiple accounts triggered tasks).</li>
                                <li>`Total_Accounts_Processed__c`: `1` (or correct count).</li>
                                <li>`DPD_Stages_Processed__c`: `10`.</li>
                                <li>`Status__c`: "Success".</li>
                                <li>`Errors__c`: Empty.</li>
                            </ul>
                        </li>
                    </ol>
                </div>
                <div class="test-results-section">
                    <h4>Test Results</h4>
                    <div class="result-grid">
                        <div class="result-field">
                            <label for="dun001-status">Status:</label>
                            <select id="dun001-status" class="status-dropdown" onchange="updateTestStatus('SIT-DUN-001', this.value)">
                                <option value="pending">Pending</option>
                                <option value="passed">Passed</option>
                                <option value="failed">Failed</option>
                                <option value="blocked">Blocked</option>
                                <option value="na">N/A</option>
                            </select>
                        </div>
                        <div class="result-field">
                            <label for="dun001-tester">Executed By:</label>
                            <input type="text" id="dun001-tester" data-testid="SIT-DUN-001" data-field="tester" placeholder="Tester Name">
                        </div>
                        <div class="result-field">
                            <label for="dun001-date">Execution Date:</label>
                            <input type="date" id="dun001-date" data-testid="SIT-DUN-001" data-field="date">
                        </div>
                        <div class="result-field">
                            <label for="dun001-duration">Execution Time (minutes):</label>
                            <input type="number" id="dun001-duration" data-testid="SIT-DUN-001" data-field="duration" min="0">
                        </div>
                        <div class="result-field">
                            <label for="dun001-env">Environment:</label>
                            <input type="text" id="dun001-env" data-testid="SIT-DUN-001" data-field="environment" value="Salesforce Sandbox">
                        </div>
                        <div class="result-field">
                            <label for="dun001-build">Build Version:</label>
                            <input type="text" id="dun001-build" data-testid="SIT-DUN-001" data-field="build" value="1.0.0">
                        </div>
                    </div>
                    <div class="result-field">
                        <label for="dun001-notes">Test Notes / Comments:</label>
                        <textarea id="dun001-notes" data-testid="SIT-DUN-001" data-field="notes" placeholder="Enter any observations or issues..."></textarea>
                    </div>
                    <div class="result-grid">
                        <div class="result-field">
                            <label for="dun001-defect">Defect ID (if failed):</label>
                            <input type="text" id="dun001-defect" data-testid="SIT-DUN-001" data-field="defect" placeholder="JIRA-123">
                        </div>
                        <div class="result-field">
                            <label for="dun001-retest">Retest Required:</label>
                            <select id="dun001-retest" data-testid="SIT-DUN-001" data-field="retest">
                                <option value="">N/A</option>
                                <option value="yes">Yes</option>
                                <option value="no">No</option>
                            </select>
                        </div>
                        <div class="result-field">
                            <label for="dun001-priority">Priority:</label>
                            <select id="dun001-priority" data-testid="SIT-DUN-001" data-field="priority">
                                <option value="critical">Critical</option>
                                <option value="high">High</option>
                                <option value="medium">Medium</option>
                                <option value="low">Low</option>
                            </select>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="test-step">
                <h5>SIT-DUN-002: Verify Task Owner Assignment Logic</h5>
                <p><strong>Description:</strong> Check that the dunning tasks created have the correct owner assigned based on the <code>Owner_Type__c</code> field in the <code>DunningTaskConfiguration__mdt</code> (e.g., Collector, Supervisor, Manager).</p>
                <div class="pre-conditions">
                    <strong>Pre-conditions:</strong>
                    <ol>
                        <li>Salesforce org accessible with Quick Receivables and Dunning Automation components deployed.</li>
                        <li>Multiple `DunningTaskConfiguration__mdt` records are active and configured with different `Owner_Type__c` values (e.g., "Collector", "Supervisor", "Manager").</li>
                        <li>Relevant Salesforce Users (Collector, Supervisor, Manager) exist and are properly linked to Accounts or have defined lookup/fallback logic for ownership.</li>
                        <li>The Apex Batch for dunning task creation is scheduled to run daily.</li>
                    </ol>
                </div>
                <div class="test-data">
                    <strong>Test Data:</strong>
                    <ol>
                        <li>Create a new Account (e.g., "DUN Test Account A") and assign its `OwnerId` to a specific Collector User (e.g., `Collector A`).</li>
                        <li>Create an Invoice for "DUN Test Account A" that will trigger a dunning task for a DPD threshold where the corresponding CMDT record has `Owner_Type__c = "Collector"`.</li>
                        <li>Create another new Account (e.g., "DUN Test Account B") and ensure it's configured to trigger a dunning task for a DPD threshold where the corresponding CMDT record has `Owner_Type__c = "Supervisor"`. Identify the expected Supervisor User based on the defined lookup/fallback logic.</li>
                        <li>Create a third new Account (e.g., "DUN Test Account C") and ensure it's configured to trigger a dunning task for a DPD threshold where the corresponding CMDT record has `Owner_Type__c = "Manager"`. Identify the expected Manager User.</li>
                        <li>Ensure `Last_DPD_Task_Created__c` is less than the triggering DPD for all invoices.</li>
                    </ol>
                </div>
                <div class="expected-result">
                    <strong>Expected Result:</strong>
                    <ol>
                        <li>After the Apex batch runs, Task records are created for "DUN Test Account A", "DUN Test Account B", and "DUN Test Account C".</li>
                        <li>For "DUN Test Account A", the created Task's `Owner` is `Collector A` (matching `Account.OwnerId`).</li>
                        <li>For "DUN Test Account B", the created Task's `Owner` is the expected Supervisor User.</li>
                        <li>For "DUN Test Account C", the created Task's `Owner` is the expected Manager User.</li>
                        <li>The `Comment` field of each created task includes all related invoice numbers for that account.</li>
                        <li>The `Last_DPD_Task_Created__c` field on all related Invoice records is updated to the respective DPD value.</li>
                        <li>The `Dunning_Task_Run_Log__c` record for the batch run correctly reflects the tasks created and accounts processed.</li>
                    </ol>
                </div>
                <div class="test-results-section">
                    <h4>Test Results</h4>
                    <div class="result-grid">
                        <div class="result-field">
                            <label for="dun002-status">Status:</label>
                            <select id="dun002-status" class="status-dropdown" onchange="updateTestStatus('SIT-DUN-002', this.value)">
                                <option value="pending">Pending</option>
                                <option value="passed">Passed</option>
                                <option value="failed">Failed</option>
                                <option value="blocked">Blocked</option>
                                <option value="na">N/A</option>
                            </select>
                        </div>
                        <div class="result-field">
                            <label for="dun002-tester">Executed By:</label>
                            <input type="text" id="dun002-tester" data-testid="SIT-DUN-002" data-field="tester" placeholder="Tester Name">
                        </div>
                        <div class="result-field">
                            <label for="dun002-date">Execution Date:</label>
                            <input type="date" id="dun002-date" data-testid="SIT-DUN-002" data-field="date">
                        </div>
                        <div class="result-field">
                            <label for="dun002-duration">Execution Time (minutes):</label>
                            <input type="number" id="dun002-duration" data-testid="SIT-DUN-002" data-field="duration" min="0">
                        </div>
                        <div class="result-field">
                            <label for="dun002-env">Environment:</label>
                            <input type="text" id="dun002-env" data-testid="SIT-DUN-002" data-field="environment" value="Salesforce Sandbox">
                        </div>
                        <div class="result-field">
                            <label for="dun002-build">Build Version:</label>
                            <input type="text" id="dun002-build" data-testid="SIT-DUN-002" data-field="build" value="1.0.0">
                        </div>
                    </div>
                    <div class="result-field">
                        <label for="dun002-notes">Test Notes / Comments:</label>
                        <textarea id="dun002-notes" data-testid="SIT-DUN-002" data-field="notes" placeholder="Enter any observations or issues..."></textarea>
                    </div>
                    <div class="result-grid">
                        <div class="result-field">
                            <label for="dun002-defect">Defect ID (if failed):</label>
                            <input type="text" id="dun002-defect" data-testid="SIT-DUN-002" data-field="defect" placeholder="JIRA-123">
                        </div>
                        <div class="result-field">
                            <label for="dun002-retest">Retest Required:</label>
                            <select id="dun002-retest" data-testid="SIT-DUN-002" data-field="retest">
                                <option value="">N/A</option>
                                <option value="yes">Yes</option>
                                <option value="no">No</option>
                            </select>
                        </div>
                        <div class="result-field">
                            <label for="dun002-priority">Priority:</label>
                            <select id="dun002-priority" data-testid="SIT-DUN-002" data-field="priority">
                                <option value="critical">Critical</option>
                                <option value="high">High</option>
                                <option value="medium">Medium</option>
                                <option value="low">Low</option>
                            </select>
                        </div>
                    </div>
                </div>
            </div>
            <div class="test-step">
                <h5>SIT-DUN-003: Verify Dunning Cycle Progression & Task Creation</h5>
                <p><strong>Description:</strong> Test that an invoice correctly progresses through multiple dunning stages if it remains unpaid, resulting in sequential task creation for each DPD milestone (e.g., 10 DPD, 20 DPD, 30 DPD), with only one task created per account per DPD.</p>
                <div class="pre-conditions">
                    <strong>Pre-conditions:</strong>
                    <ol>
                        <li>Salesforce org accessible with Quick Receivables and Dunning Automation components deployed.</li>
                        <li>Multiple `DunningTaskConfiguration__mdt` records are active for different DPD thresholds (e.g., 10, 20, 30 DPD) with `Is_Active__c = true`.</li>
                        <li>The Apex Batch for dunning task creation is scheduled to run daily.</li>
                        <li>The `Dunning_Task_Run_Log__c` custom object is configured for logging.</li>
                    </ol>
                </div>
                <div class="test-data">
                    <strong>Test Data:</strong>
                    <ol>
                        <li>Create a new Account (e.g., "DUN Cycle Test Account").</li>
                        <li>Create an Invoice record for "DUN Cycle Test Account" with a `Due Date` that allows it to sequentially pass through multiple DPD thresholds over several days. For example:
                            <ul>
                                <li>Invoice Due Date: July 15, 2025</li>
                                <li>Today (Test Day 1): July 25, 2025 (10 DPD)</li>
                                <li>Next Batch Run (Test Day 2): August 4, 2025 (20 DPD)</li>
                                <li>Next Batch Run (Test Day 3): August 14, 2025 (30 DPD)</li>
                            </ul>
                        </li>
                        <li>Ensure `Last_DPD_Task_Created__c` is initially null or 0 on the invoice.</li>
                        <li>Ensure no payments are applied to this invoice during the test period.</li>
                    </ol>
                </div>
                <div class="expected-result">
                    <strong>Expected Result:</strong>
                    <ol>
                        <li><strong>After Test Day 1 (10 DPD Batch Run):</strong>
                            <ul>
                                <li>Exactly one Task is created for 10 DPD for "DUN Cycle Test Account".</li>
                                <li>The `Last_DPD_Task_Created__c` field on the invoice updates to `10`.</li>
                                <li>`Dunning_Task_Run_Log__c` shows a successful entry for 10 DPD.</li>
                            </ul>
                        </li>
                        <li><strong>After Test Day 2 (20 DPD Batch Run):</strong>
                            <ul>
                                <li>A new, separate Task is created for 20 DPD for "DUN Cycle Test Account".</li>
                                <li>The `Last_DPD_Task_Created__c` field on the invoice updates to `20`.</li>
                                <li>`Dunning_Task_Run_Log__c` shows a successful entry for 20 DPD.</li>
                            </ul>
                        </li>
                        <li><strong>After Test Day 3 (30 DPD Batch Run):</strong>
                            <ul>
                                <li>A new, separate Task is created for 30 DPD for "DUN Cycle Test Account".</li>
                                <li>The `Last_DPD_Task_Created__c` field on the invoice updates to `30`.</li>
                                <li>`Dunning_Task_Run_Log__c` shows a successful entry for 30 DPD.</li>
                            </ul>
                        </li>
                        <li>Verify that only one task is created per account per DPD threshold, even if multiple invoices for that account reach the same DPD.</li>
                    </ol>
                </div>
                <div class="test-results-section">
                    <h4>Test Results</h4>
                    <div class="result-grid">
                        <div class="result-field">
                            <label for="dun003-status">Status:</label>
                            <select id="dun003-status" class="status-dropdown" onchange="updateTestStatus('SIT-DUN-003', this.value)">
                                <option value="pending">Pending</option>
                                <option value="passed">Passed</option>
                                <option value="failed">Failed</option>
                                <option value="blocked">Blocked</option>
                                <option value="na">N/A</option>
                            </select>
                        </div>
                        <div class="result-field">
                            <label for="dun003-tester">Executed By:</label>
                            <input type="text" id="dun003-tester" data-testid="SIT-DUN-003" data-field="tester" placeholder="Tester Name">
                        </div>
                        <div class="result-field">
                            <label for="dun003-date">Execution Date:</label>
                            <input type="date" id="dun003-date" data-testid="SIT-DUN-003" data-field="date">
                        </div>
                        <div class="result-field">
                            <label for="dun003-duration">Execution Time (minutes):</label>
                            <input type="number" id="dun003-duration" data-testid="SIT-DUN-003" data-field="duration" min="0">
                        </div>
                        <div class="result-field">
                            <label for="dun003-env">Environment:</label>
                            <input type="text" id="dun003-env" data-testid="SIT-DUN-003" data-field="environment" value="Salesforce Sandbox">
                        </div>
                        <div class="result-field">
                            <label for="dun003-build">Build Version:</label>
                            <input type="text" id="dun003-build" data-testid="SIT-DUN-003" data-field="build" value="1.0.0">
                        </div>
                    </div>
                    <div class="result-field">
                        <label for="dun003-notes">Test Notes / Comments:</label>
                        <textarea id="dun003-notes" data-testid="SIT-DUN-003" data-field="notes" placeholder="Enter any observations or issues..."></textarea>
                    </div>
                    <div class="result-grid">
                        <div class="result-field">
                            <label for="dun003-defect">Defect ID (if failed):</label>
                            <input type="text" id="dun003-defect" data-testid="SIT-DUN-003" data-field="defect" placeholder="JIRA-123">
                        </div>
                        <div class="result-field">
                            <label for="dun003-retest">Retest Required:</label>
                            <select id="dun003-retest" data-testid="SIT-DUN-003" data-field="retest">
                                <option value="">N/A</option>
                                <option value="yes">Yes</option>
                                <option value="no">No</option>
                            </select>
                        </div>
                        <div class="result-field">
                            <label for="dun003-priority">Priority:</label>
                            <select id="dun003-priority" data-testid="SIT-DUN-003" data-field="priority">
                                <option value="critical">Critical</option>
                                <option value="high">High</option>
                                <option value="medium">Medium</option>
                                <option value="low">Low</option>
                            </select>
                        </div>
                    </div>
                </div>
            </div>
            <div class="test-step">
                <h5>SIT-DUN-004: Verify Dunning Suspension on Payment</h5>
                <p><strong>Description:</strong> Test that the dunning task creation process is correctly suspended or prevented for an account if a full payment is received for all overdue invoices before the next DPD threshold is met.</p>
                <div class="pre-conditions">
                    <strong>Pre-conditions:</strong>
                    <ol>
                        <li>SIT-SAP-003 (Payment Data Sync) is functional and ensures timely updates of invoice `Due Amount` and `DPD__c` fields in Salesforce.</li>
                        <li>Multiple `DunningTaskConfiguration__mdt` records are active for different DPD thresholds (e.g., 10, 20 DPD).</li>
                        <li>The Apex Batch for dunning task creation is scheduled to run daily.</li>
                        <li>The `Dunning_Task_Run_Log__c` custom object is configured for logging.</li>
                    </ol>
                </div>
                <div class="test-data">
                    <strong>Test Data:</strong>
                    <ol>
                        <li>Create an Account (e.g., "DUN Payment Suspension Account") with one or more Invoice records that are currently overdue (e.g., 15 DPD, which should have triggered a 10 DPD task already). Ensure `Last_DPD_Task_Created__c` is 10 for these invoices.</li>
                        <li>Apply a full payment to *all* overdue invoices for "DUN Payment Suspension Account" via SAP (e.g., using an `ARCASH` file), ensuring the payment syncs to Salesforce and updates the `Due Amount` to $0.00 and `DPD__c` to 0 for these invoices *before* the next scheduled Apex batch run for the 20 DPD threshold.</li>
                    </ol>
                </div>
                <div class="expected-result">
                    <strong>Expected Result:</strong>
                    <ol>
                        <li>After the payment syncs, the `Due Amount` on the invoice(s) should be $0.00 and `DPD__c` should be 0.</li>
                        <li>When the Apex batch runs for the 20 DPD threshold, no new dunning task is created for "DUN Payment Suspension Account".</li>
                        <li>The `Dunning_Task_Run_Log__c` record for the batch run should reflect that no new tasks were created for this account/DPD stage, or that the account was skipped due to no longer meeting the criteria.</li>
                        <li>The `Total_Tasks_Created__c` in the `Dunning_Task_Run_Log__c` for this specific batch run should not include any tasks for this account.</li>
                    </ol>
                </div>
                <div class="test-results-section">
                    <h4>Test Results</h4>
                    <div class="result-grid">
                        <div class="result-field">
                            <label for="dun004-status">Status:</label>
                            <select id="dun004-status" class="status-dropdown" onchange="updateTestStatus('SIT-DUN-004', this.value)">
                                <option value="pending">Pending</option>
                                <option value="passed">Passed</option>
                                <option value="failed">Failed</option>
                                <option value="blocked">Blocked</option>
                                <option value="na">N/A</option>
                            </select>
                        </div>
                        <div class="result-field">
                            <label for="dun004-tester">Executed By:</label>
                            <input type="text" id="dun004-tester" data-testid="SIT-DUN-004" data-field="tester" placeholder="Tester Name">
                        </div>
                        <div class="result-field">
                            <label for="dun004-date">Execution Date:</label>
                            <input type="date" id="dun004-date" data-testid="SIT-DUN-004" data-field="date">
                        </div>
                        <div class="result-field">
                            <label for="dun004-duration">Execution Time (minutes):</label>
                            <input type="number" id="dun004-duration" data-testid="SIT-DUN-004" data-field="duration" min="0">
                        </div>
                        <div class="result-field">
                            <label for="dun004-env">Environment:</label>
                            <input type="text" id="dun004-env" data-testid="SIT-DUN-004" data-field="environment" value="Salesforce Sandbox">
                        </div>
                        <div class="result-field">
                            <label for="dun004-build">Build Version:</label>
                            <input type="text" id="dun004-build" data-testid="SIT-DUN-004" data-field="build" value="1.0.0">
                        </div>
                    </div>
                    <div class="result-field">
                        <label for="dun004-notes">Test Notes / Comments:</label>
                        <textarea id="dun004-notes" data-testid="SIT-DUN-004" data-field="notes" placeholder="Enter any observations or issues..."></textarea>
                    </div>
                    <div class="result-grid">
                        <div class="result-field">
                            <label for="dun004-defect">Defect ID (if failed):</label>
                            <input type="text" id="dun004-defect" data-testid="SIT-DUN-004" data-field="defect" placeholder="JIRA-123">
                        </div>
                        <div class="result-field">
                            <label for="dun004-retest">Retest Required:</label>
                            <select id="dun004-retest" data-testid="SIT-DUN-004" data-field="retest">
                                <option value="">N/A</option>
                                <option value="yes">Yes</option>
                                <option value="no">No</option>
                            </select>
                        </div>
                        <div class="result-field">
                            <label for="dun004-priority">Priority:</label>
                            <select id="dun004-priority" data-testid="SIT-DUN-004" data-field="priority">
                                <option value="critical">Critical</option>
                                <option value="high">High</option>
                                <option value="medium">Medium</option>
                                <option value="low">Low</option>
                            </select>
                        </div>
                    </div>
                </div>
            </div>
            <div class="test-step">
                <h5>SIT-DUN-005: Error Handling - Missing CMDT Configuration & Batch Resilience</h5>
                <p><strong>Description:</strong> Test how the system behaves when critical <code>DunningTaskConfiguration__mdt</code> configurations for a specific DPD are missing or incomplete, ensuring the Apex batch runs gracefully, logs errors, and does not create tasks for the misconfigured stage.</p>
                <div class="pre-conditions">
                    <strong>Pre-conditions:</strong>
                    <ol>
                        <li>Salesforce org accessible with Dunning Automation components deployed.</li>
                        <li>The Apex Batch for dunning task creation is scheduled to run daily.</li>
                        <li>The `Dunning_Task_Run_Log__c` custom object is configured for logging.</li>
                        <li>Identify a DPD threshold (e.g., 45 DPD) for which the corresponding `DunningTaskConfiguration__mdt` record will be intentionally deactivated or misconfigured (e.g., `Is_Active__c = false`, or a required field like `Task_Subject__c` is empty).</li>
                    </ol>
                </div>
                <div class="test-data">
                    <strong>Test Data:</strong>
                    <ol>
                        <li>Create a new Account (e.g., "DUN Error Test Account").</li>
                        <li>Create an Invoice record for "DUN Error Test Account" with a `Due Date` that makes it exactly 45 DPD on the test day. Ensure `Last_DPD_Task_Created__c` is less than 45.</li>
                        <li>Before the Apex batch runs, intentionally deactivate or misconfigure the `DunningTaskConfiguration__mdt` record for 45 DPD. For example:
                            <ul>
                                <li>Set `Is_Active__c = false` for the 45 DPD record.</li>
                                <li>Alternatively, leave `Task_Subject__c` blank for the 45 DPD record.</li>
                            </ul>
                        </li>
                    </ol>
                </div>
                <div class="expected-result">
                    <strong>Expected Result:</strong>
                    <ol>
                        <li>The Apex batch runs and completes without crashing (i.e., the batch job status is `Completed` or `Completed with Errors`, not `Failed`).</li>
                        <li>No dunning task is created for "DUN Error Test Account" for the 45 DPD threshold.</li>
                        <li>The `Last_DPD_Task_Created__c` field on the invoice for "DUN Error Test Account" is *not* updated to 45 (it should retain its previous value or remain null).</li>
                        <li>A `Dunning_Task_Run_Log__c` custom object record is created for the batch run with:
                            <ul>
                                <li>`Execution_Date__c`: Timestamp of batch run.</li>
                                <li>`Status__c`: "Failed" or "Partial Success".</li>
                                <li>`Errors__c`: Contains a detailed error message indicating that the 45 DPD CMDT configuration was missing, inactive, or malformed, and that tasks could not be created for that stage.</li>
                                <li>`Total_Tasks_Created__c`: Should reflect tasks created for *other* valid DPD stages, but not for 45 DPD.</li>
                            </ul>
                        </li>
                    </ol>
                </div>
                <div class="test-results-section">
                    <h4>Test Results</h4>
                    <div class="result-grid">
                        <div class="result-field">
                            <label for="dun005-status">Status:</label>
                            <select id="dun005-status" class="status-dropdown" onchange="updateTestStatus('SIT-DUN-005', this.value)">
                                <option value="pending">Pending</option>
                                <option value="passed">Passed</option>
                                <option value="failed">Failed</option>
                                <option value="blocked">Blocked</option>
                                <option value="na">N/A</option>
                            </select>
                        </div>
                        <div class="result-field">
                            <label for="dun005-tester">Executed By:</label>
                            <input type="text" id="dun005-tester" data-testid="SIT-DUN-005" data-field="tester" placeholder="Tester Name">
                        </div>
                        <div class="result-field">
                            <label for="dun005-date">Execution Date:</label>
                            <input type="date" id="dun005-date" data-testid="SIT-DUN-005" data-field="date">
                        </div>
                        <div class="result-field">
                            <label for="dun005-duration">Execution Time (minutes):</label>
                            <input type="number" id="dun005-duration" data-testid="SIT-DUN-005" data-field="duration" min="0">
                        </div>
                        <div class="result-field">
                            <label for="dun005-env">Environment:</label>
                            <input type="text" id="dun005-env" data-testid="SIT-DUN-005" data-field="environment" value="Salesforce Sandbox">
                        </div>
                        <div class="result-field">
                            <label for="dun005-build">Build Version:</label>
                            <input type="text" id="dun005-build" data-testid="SIT-DUN-005" data-field="build" value="1.0.0">
                        </div>
                    </div>
                    <div class="result-field">
                        <label for="dun005-notes">Test Notes / Comments:</label>
                        <textarea id="dun005-notes" data-testid="SIT-DUN-005" data-field="notes" placeholder="Enter any observations or issues..."></textarea>
                    </div>
                    <div class="result-grid">
                        <div class="result-field">
                            <label for="dun005-defect">Defect ID (if failed):</label>
                            <input type="text" id="dun005-defect" data-testid="SIT-DUN-005" data-field="defect" placeholder="JIRA-123">
                        </div>
                        <div class="result-field">
                            <label for="dun005-retest">Retest Required:</label>
                            <select id="dun005-retest" data-testid="SIT-DUN-005" data-field="retest">
                                <option value="">N/A</option>
                                <option value="yes">Yes</option>
                                <option value="no">No</option>
                            </select>
                        </div>
                        <div class="result-field">
                            <label for="dun005-priority">Priority:</label>
                            <select id="dun005-priority" data-testid="SIT-DUN-005" data-field="priority">
                                <option value="critical">Critical</option>
                                <option value="high">High</option>
                                <option value="medium">Medium</option>
                                <option value="low">Low</option>
                            </select>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Test Schedule Tab -->
        <div id="schedule" class="tab-content">
            <h2 class="section-header">Test Schedule</h2>
            <p>Detailed daily schedule for SIT execution, including planned test cases and daily progress tracking.</p>
            
            <div class="table-container">
                <table>
                    <thead>
                        <tr>
                            <th>Date</th>
                            <th>Planned Test Cases</th>
                            <th>Executed</th>
                            <th>Passed</th>
                            <th>Failed</th>
                            <th>Notes</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><strong>Aug 11, 2025</strong></td>
                            <td>SIT-SAP-001, SIT-SAP-002</td>
                            <td><input type="number" min="0" max="2" value="0" class="daily-executed" data-date="aug11"></td>
                            <td><input type="number" min="0" max="2" value="0" class="daily-passed" data-date="aug11"></td>
                            <td><input type="number" min="0" max="2" value="0" class="daily-failed" data-date="aug11"></td>
                            <td><input type="text" placeholder="Daily notes..." class="daily-notes" data-date="aug11"></td>
                        </tr>
                        <tr>
                            <td><strong>Aug 12, 2025</strong></td>
                            <td>SIT-SAP-003, SIT-DL-001</td>
                            <td><input type="number" min="0" max="2" value="0" class="daily-executed" data-date="aug12"></td>
                            <td><input type="number" min="0" max="2" value="0" class="daily-passed" data-date="aug12"></td>
                            <td><input type="number" min="0" max="2" value="0" class="daily-failed" data-date="aug12"></td>
                            <td><input type="text" placeholder="Daily notes..." class="daily-notes" data-date="aug12"></td>
                        </tr>
                        <tr>
                            <td><strong>Aug 13, 2025</strong></td>
                            <td>SIT-DL-002, SIT-DL-003</td>
                            <td><input type="number" min="0" max="2" value="0" class="daily-executed" data-date="aug13"></td>
                            <td><input type="number" min="0" max="2" value="0" class="daily-passed" data-date="aug13"></td>
                            <td><input type="number" min="0" max="2" value="0" class="daily-failed" data-date="aug13"></td>
                            <td><input type="text" placeholder="Daily notes..." class="daily-notes" data-date="aug13"></td>
                        </tr>
                        <tr>
                            <td><strong>Aug 14, 2025</strong></td>
                            <td>SIT-DL-004, SIT-SAP-004</td>
                            <td><input type="number" min="0" max="2" value="0" class="daily-executed" data-date="aug14"></td>
                            <td><input type="number" min="0" max="2" value="0" class="daily-passed" data-date="aug14"></td>
                            <td><input type="number" min="0" max="2" value="0" class="daily-failed" data-date="aug14"></td>
                            <td><input type="text" placeholder="Daily notes..." class="daily-notes" data-date="aug14"></td>
                        </tr>
                        <tr>
                            <td><strong>Aug 15, 2025</strong></td>
                            <td>SIT-MC-001, SIT-MC-002</td>
                            <td><input type="number" min="0" max="2" value="0" class="daily-executed" data-date="aug15"></td>
                            <td><input type="number" min="0" max="2" value="0" class="daily-passed" data-date="aug15"></td>
                            <td><input type="number" min="0" max="2" value="0" class="daily-failed" data-date="aug15"></td>
                            <td><input type="text" placeholder="Daily notes..." class="daily-notes" data-date="aug15"></td>
                        </tr>
                        <tr>
                            <td><strong>Aug 18, 2025</strong></td>
                            <td>SIT-MC-003, SIT-MC-004</td>
                            <td><input type="number" min="0" max="2" value="0" class="daily-executed" data-date="aug18"></td>
                            <td><input type="number" min="0" max="2" value="0" class="daily-passed" data-date="aug18"></td>
                            <td><input type="number" min="0" max="2" value="0" class="daily-failed" data-date="aug18"></td>
                            <td><input type="text" placeholder="Daily notes..." class="daily-notes" data-date="aug18"></td>
                        </tr>
                        <tr>
                            <td><strong>Aug 19, 2025</strong></td>
                            <td>SIT-MC-005, SIT-DUN-001</td>
                            <td><input type="number" min="0" max="2" value="0" class="daily-executed" data-date="aug19"></td>
                            <td><input type="number" min="0" max="2" value="0" class="daily-passed" data-date="aug19"></td>
                            <td><input type="number" min="0" max="2" value="0" class="daily-failed" data-date="aug19"></td>
                            <td><input type="text" placeholder="Daily notes..." class="daily-notes" data-date="aug19"></td>
                        </tr>
                        <tr>
                            <td><strong>Aug 20, 2025</strong></td>
                            <td>SIT-DUN-002, SIT-DUN-003</td>
                            <td><input type="number" min="0" max="2" value="0" class="daily-executed" data-date="aug20"></td>
                            <td><input type="number" min="0" max="2" value="0" class="daily-passed" data-date="aug20"></td>
                            <td><input type="number" min="0" max="2" value="0" class="daily-failed" data-date="aug20"></td>
                            <td><input type="text" placeholder="Daily notes..." class="daily-notes" data-date="aug20"></td>
                        </tr>
                        <tr>
                            <td><strong>Aug 21, 2025</strong></td>
                            <td>SIT-DUN-004, SIT-DUN-005</td>
                            <td><input type="number" min="0" max="2" value="0" class="daily-executed" data-date="aug21"></td>
                            <td><input type="number" min="0" max="2" value="0" class="daily-passed" data-date="aug21"></td>
                            <td><input type="number" min="0" max="2" value="0" class="daily-failed" data-date="aug21"></td>
                            <td><input type="text" placeholder="Daily notes..." class="daily-notes" data-date="aug21"></td>
                        </tr>
                        <tr>
                            <td><strong>Aug 22, 2025</strong></td>
                            <td>SIT-SAP-005</td>
                            <td><input type="number" min="0" max="1" value="0" class="daily-executed" data-date="aug22"></td>
                            <td><input type="number" min="0" max="1" value="0" class="daily-passed" data-date="aug22"></td>
                            <td><input type="number" min="0" max="1" value="0" class="daily-failed" data-date="aug22"></td>
                            <td><input type="text" placeholder="Daily notes..." class="daily-notes" data-date="aug22"></td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- Export Format Modal -->
    <div id="exportFormatModal" class="export-format-modal">
        <div class="modal-content">
            <h3>Select Export Format</h3>
            <div class="format-options">
                <div class="format-option" data-format="csv">
                    <h4>CSV</h4>
                    <p>Comma Separated Values</p>
                </div>
                <!-- Add more format options here if needed -->
            </div>
            <div class="modal-buttons">
                <button class="btn btn-secondary" onclick="closeExportModal()">Cancel</button>
                <button class="btn btn-primary" onclick="exportResults()">Export</button>
            </div>
        </div>
    </div>
</body>
</html>
